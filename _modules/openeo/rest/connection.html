<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>openeo.rest.connection &#8212; openEO Python Client 0.49.0a1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=ad3dbffd" />
    <script src="../../../_static/documentation_options.js?v=6f1c2e36"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for openeo.rest.connection</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides a Connection object to manage and persist settings when interacting with the OpenEO API.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shlex</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePosixPath</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely.geometry.base</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib3.util</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthBase</span><span class="p">,</span> <span class="n">HTTPBasicAuth</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">openeo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_log</span><span class="p">,</span> <span class="n">get_config_option</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.internal.documentation</span><span class="w"> </span><span class="kn">import</span> <span class="n">openeo_process</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.internal.graph_building</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FlatGraphableMixin</span><span class="p">,</span>
    <span class="n">PGNode</span><span class="p">,</span>
    <span class="n">_FromNodeMixin</span><span class="p">,</span>
    <span class="n">as_flat_graph</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.internal.jupyter</span><span class="w"> </span><span class="kn">import</span> <span class="n">VisualDict</span><span class="p">,</span> <span class="n">VisualList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.internal.processes.builder</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessBuilderBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.internal.warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">legacy_alias</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">CollectionMetadata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_DOWNLOAD_CHUNK_SIZE</span><span class="p">,</span>
    <span class="n">CapabilitiesException</span><span class="p">,</span>
    <span class="n">OpenEoApiError</span><span class="p">,</span>
    <span class="n">OpenEoClientException</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest._connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span> <span class="n">RestApiConnection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest._datacube</span><span class="w"> </span><span class="kn">import</span> <span class="n">_ProcessGraphAbstraction</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.auth.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasicBearerAuth</span><span class="p">,</span> <span class="n">BearerAuth</span><span class="p">,</span> <span class="n">OidcBearerAuth</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.auth.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthConfig</span><span class="p">,</span> <span class="n">RefreshTokenStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.auth.oidc</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DefaultOidcClientGrant</span><span class="p">,</span>
    <span class="n">GrantsChecker</span><span class="p">,</span>
    <span class="n">OidcAuthCodePkceAuthenticator</span><span class="p">,</span>
    <span class="n">OidcAuthenticator</span><span class="p">,</span>
    <span class="n">OidcClientCredentialsAuthenticator</span><span class="p">,</span>
    <span class="n">OidcClientInfo</span><span class="p">,</span>
    <span class="n">OidcDeviceAuthenticator</span><span class="p">,</span>
    <span class="n">OidcException</span><span class="p">,</span>
    <span class="n">OidcProviderInfo</span><span class="p">,</span>
    <span class="n">OidcRefreshTokenAuthenticator</span><span class="p">,</span>
    <span class="n">OidcResourceOwnerPasswordAuthenticator</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.capabilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenEoCapabilities</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.datacube</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataCube</span><span class="p">,</span> <span class="n">InputDate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.graph_building</span><span class="w"> </span><span class="kn">import</span> <span class="n">CollectionProperty</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.job</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchJob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.mlmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">MlModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.models.general</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CollectionListingResponse</span><span class="p">,</span>
    <span class="n">JobListingResponse</span><span class="p">,</span>
    <span class="n">ProcessListingResponse</span><span class="p">,</span>
    <span class="n">ValidationResponse</span><span class="p">,</span>
    <span class="n">federation_extension</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">SaveResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.service</span><span class="w"> </span><span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.udp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">RESTUserDefinedProcess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.userfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.vectorcube</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorCube</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.util</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LazyLoadCache</span><span class="p">,</span>
    <span class="n">dict_no_none</span><span class="p">,</span>
    <span class="n">ensure_dir</span><span class="p">,</span>
    <span class="n">load_json_resource</span><span class="p">,</span>
    <span class="n">rfc3339</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.utils.http</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">HTTP_201_CREATED</span><span class="p">,</span>
    <span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
    <span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.utils.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComparableVersion</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Connection&quot;</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">]</span>

<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Default timeouts for requests</span>
<span class="n">DEFAULT_TIMEOUT_SYNCHRONOUS_EXECUTE</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>


<span class="n">ResponseHeadersHandler</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Mapping</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>


<div class="viewcode-block" id="Connection">
<a class="viewcode-back" href="../../../api.html#openeo.Connection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Connection</span><span class="p">(</span><span class="n">RestApiConnection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connection to an openEO backend.</span>

<span class="sd">    :param url: Backend root url</span>
<span class="sd">    :param session: Optional ``requests.Session`` object to use for requests.</span>
<span class="sd">    :param default_timeout: Default timeout for requests in seconds.</span>
<span class="sd">    :param auto_validate: toggle to automatically validate process graphs before execution</span>
<span class="sd">    :param slow_response_threshold: Optional threshold in seconds</span>
<span class="sd">        to consider a response as slow and log a warning.</span>
<span class="sd">    :param auth_config: Optional :class:`AuthConfig` object</span>
<span class="sd">        to fetch authentication related configuration from.</span>
<span class="sd">    :param refresh_token_store: For advanced usage:</span>
<span class="sd">        custom :class:`RefreshTokenStore` object</span>
<span class="sd">        to use for storing/loading refresh tokens.</span>
<span class="sd">    :param oidc_auth_renewer: For advanced usage:</span>
<span class="sd">        optional :class:`OidcAuthenticator` object to use for renewing OIDC tokens.</span>
<span class="sd">    :param auth: Optional ``requests.auth.AuthBase`` object to use for requests.</span>
<span class="sd">        Usage of this parameter is deprecated, use the specific authentication methods instead.</span>
<span class="sd">    :param retry: general request retry settings, can be specified as:</span>

<span class="sd">        - :py:class:`urllib3.util.Retry` object</span>
<span class="sd">          or a dictionary with corresponding keyword arguments</span>
<span class="sd">          (e.g. ``total``, ``backoff_factor``, ``status_forcelist``, ...)</span>
<span class="sd">        - ``None`` (default) to use default openEO-oriented retry settings</span>
<span class="sd">        - ``False`` to disable retrying requests</span>

<span class="sd">    :param on_response_headers_sync: (optional) callback to handle (e.g. :py:func:`print`)</span>
<span class="sd">        the response headers of synchronous processing requests.</span>

<span class="sd">    .. versionchanged:: 0.41.0</span>
<span class="sd">        Added ``retry`` argument.</span>

<span class="sd">    .. versionchanged:: 0.48</span>
<span class="sd">            Added argument ``on_response_headers_sync``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_MINIMUM_API_VERSION</span> <span class="o">=</span> <span class="n">ComparableVersion</span><span class="p">(</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">slow_response_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auth_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AuthConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh_token_store</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RefreshTokenStore</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">oidc_auth_renewer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OidcAuthenticator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AuthBase</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Retry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_response_headers_sync</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResponseHeadersHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;://&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span> <span class="o">+</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span> <span class="o">=</span> <span class="n">LazyLoadCache</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">root_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version_discovery</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">default_timeout</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">),</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">default_timeout</span><span class="o">=</span><span class="n">default_timeout</span><span class="p">,</span>
            <span class="n">slow_response_threshold</span><span class="o">=</span><span class="n">slow_response_threshold</span><span class="p">,</span>
            <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Initial API version check.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span><span class="o">.</span><span class="n">require_at_least</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MINIMUM_API_VERSION</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_config</span> <span class="o">=</span> <span class="n">auth_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_token_store</span> <span class="o">=</span> <span class="n">refresh_token_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span> <span class="o">=</span> <span class="n">oidc_auth_renewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_validate</span> <span class="o">=</span> <span class="n">auto_validate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_response_headers_sync</span> <span class="o">=</span> <span class="n">on_response_headers_sync</span>

<div class="viewcode-block" id="Connection.version_discovery">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.version_discovery">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">version_discovery</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Retry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do automatic openEO API version discovery from given url, using a &quot;well-known URI&quot; strategy.</span>

<span class="sd">        :param url: initial backend url (not including &quot;/.well-known/openeo&quot;)</span>
<span class="sd">        :return: root url of highest supported backend version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">RestApiConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
            <span class="n">well_known_url_response</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/.well-known/openeo&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">well_known_url_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="n">well_known_url_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;versions&quot;</span><span class="p">]</span>
            <span class="n">supported_versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">versions</span> <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_MINIMUM_API_VERSION</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;api_version&quot;</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="n">supported_versions</span>
            <span class="n">production_versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">supported_versions</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
            <span class="n">highest_version</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">production_versions</span> <span class="ow">or</span> <span class="n">supported_versions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;api_version&quot;</span><span class="p">])</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Highest supported version available in backend: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">highest_version</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">highest_version</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Be very lenient about failing on the well-known URI strategy.</span>
            <span class="k">return</span> <span class="n">url</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_on_auth_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_on_auth_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_auth_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AuthConfig</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_config</span> <span class="o">=</span> <span class="n">AuthConfig</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_refresh_token_store</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RefreshTokenStore</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_token_store</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_token_store</span> <span class="o">=</span> <span class="n">RefreshTokenStore</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_token_store</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_auth_providers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
        <span class="n">providers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span>

        <span class="c1"># Add OIDC providers</span>
        <span class="n">oidc_path</span> <span class="o">=</span> <span class="s2">&quot;/credentials/oidc&quot;</span>
        <span class="k">if</span> <span class="n">cap</span><span class="o">.</span><span class="n">supports_endpoint</span><span class="p">(</span><span class="n">oidc_path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">oidc_path</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;providers&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">provider</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;oidc&quot;</span>
                        <span class="n">providers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">OpenEoApiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to load the OpenID Connect provider list: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add Basic provider</span>
        <span class="n">basic_path</span> <span class="o">=</span> <span class="s2">&quot;/credentials/basic&quot;</span>
        <span class="k">if</span> <span class="n">cap</span><span class="o">.</span><span class="n">supports_endpoint</span><span class="p">(</span><span class="n">basic_path</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">):</span>
            <span class="n">providers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">basic_path</span><span class="p">,</span>
                    <span class="s2">&quot;issuer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_url</span><span class="p">(</span><span class="n">basic_path</span><span class="p">),</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Internal&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The HTTP Basic authentication method is mostly used for development and testing purposes.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">providers</span>

<div class="viewcode-block" id="Connection.authenticate_basic">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_basic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate a user to the backend using basic username and password.</span>

<span class="sd">        :param username: User name</span>
<span class="sd">        :param password: User passphrase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">supports_endpoint</span><span class="p">(</span><span class="s2">&quot;/credentials/basic&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;This openEO back-end does not support basic authentication.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_auth_config</span><span class="p">()</span><span class="o">.</span><span class="n">get_basic_auth</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;No username/password given or found.&quot;</span><span class="p">)</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;/credentials/basic&#39;</span><span class="p">,</span>
            <span class="c1"># /credentials/basic is the only endpoint that expects a Basic HTTP auth</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># Switch to bearer based authentication in further requests.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">BasicBearerAuth</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_oidc_provider</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">provider_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parse_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">OidcProviderInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get provider id and info, based on context.</span>
<span class="sd">        If provider_id is given, verify it against backend&#39;s list of providers.</span>
<span class="sd">        If not given, find a suitable provider based on env vars, config or backend&#39;s default.</span>

<span class="sd">        :param provider_id: id of OIDC provider as specified by backend (/credentials/oidc).</span>
<span class="sd">            Can be None if there is just one provider.</span>
<span class="sd">        :param parse_info: whether to parse the provider info into an :py:class:`OidcProviderInfo` object</span>
<span class="sd">            (which involves a &quot;.well-known/openid-configuration&quot; request)</span>
<span class="sd">        :return: resolved/verified provider_id and provider info object (unless ``parse_info`` is False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oidc_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/credentials/oidc&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">providers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">oidc_info</span><span class="p">[</span><span class="s2">&quot;providers&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;Backend lists no OIDC providers.&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found OIDC providers: </span><span class="si">{p}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">providers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="c1"># TODO: also support specifying provider through issuer URL?</span>
        <span class="n">provider_id_from_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPENEO_AUTH_PROVIDER_ID&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">provider_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">provider_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">providers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span>
                    <span class="s2">&quot;Requested OIDC provider </span><span class="si">{r!r}</span><span class="s2"> not available. Should be one of </span><span class="si">{p}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">r</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">providers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">provider</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="n">provider_id</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">provider_id_from_env</span> <span class="ow">and</span> <span class="n">provider_id_from_env</span> <span class="ow">in</span> <span class="n">providers</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using provider_id </span><span class="si">{</span><span class="n">provider_id_from_env</span><span class="si">!r}</span><span class="s2"> from OPENEO_AUTH_PROVIDER_ID env var&quot;</span><span class="p">)</span>
            <span class="n">provider_id</span> <span class="o">=</span> <span class="n">provider_id_from_env</span>
            <span class="n">provider</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="n">provider_id</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">providers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">provider_id</span><span class="p">,</span> <span class="n">provider</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No OIDC provider given, but only one available: </span><span class="si">{</span><span class="n">provider_id</span><span class="si">!r}</span><span class="s2">. Using that one.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check if there is a single provider in the config to use.</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_url</span>
            <span class="n">provider_configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_auth_config</span><span class="p">()</span><span class="o">.</span><span class="n">get_oidc_provider_configs</span><span class="p">(</span>
                <span class="n">backend</span><span class="o">=</span><span class="n">backend</span>
            <span class="p">)</span>
            <span class="n">intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">provider_configs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">providers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">provider_id</span> <span class="o">=</span> <span class="n">intersection</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="n">provider_id</span><span class="p">]</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No OIDC provider given, but only one in config (for backend </span><span class="si">{</span><span class="n">backend</span><span class="si">!r}</span><span class="s2">): </span><span class="si">{</span><span class="n">provider_id</span><span class="si">!r}</span><span class="s2">. Using that one.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">provider_id</span><span class="p">,</span> <span class="n">provider</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No OIDC provider given. Using first provider </span><span class="si">{</span><span class="n">provider_id</span><span class="si">!r}</span><span class="s2"> as advertised by backend.&quot;</span>
                <span class="p">)</span>

        <span class="n">provider_info</span> <span class="o">=</span> <span class="n">OidcProviderInfo</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span> <span class="k">if</span> <span class="n">parse_info</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">provider_id</span><span class="p">,</span> <span class="n">provider_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_oidc_provider_and_client_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_client_grant_check</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">GrantsChecker</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OidcClientInfo</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve provider_id and client info (as given or from config)</span>

<span class="sd">        :param provider_id: id of OIDC provider as specified by backend (/credentials/oidc).</span>
<span class="sd">            Can be None if there is just one provider.</span>

<span class="sd">        :return: OIDC provider id and client info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">provider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider</span><span class="p">(</span><span class="n">provider_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No client_id: checking config for preferred client_id&quot;</span><span class="p">)</span>
            <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_auth_config</span><span class="p">()</span><span class="o">.</span><span class="n">get_oidc_client_configs</span><span class="p">(</span>
                <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_url</span><span class="p">,</span> <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">client_id</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using client_id </span><span class="si">{c!r}</span><span class="s2"> from config (provider </span><span class="si">{p!r}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">provider_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">default_client_grant_check</span><span class="p">:</span>
            <span class="c1"># Try &quot;default_clients&quot; from backend&#39;s provider info.</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No client_id given: checking default clients in backend&#39;s provider info&quot;</span><span class="p">)</span>
            <span class="n">client_id</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_default_client_id</span><span class="p">(</span><span class="n">grant_check</span><span class="o">=</span><span class="n">default_client_grant_check</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">client_id</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using default client_id </span><span class="si">{c!r}</span><span class="s2"> from OIDC provider </span><span class="si">{p!r}</span><span class="s2"> info.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">provider_id</span>
                <span class="p">))</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;No client_id found.&quot;</span><span class="p">)</span>

        <span class="n">client_info</span> <span class="o">=</span> <span class="n">OidcClientInfo</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span> <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_authenticate_oidc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">authenticator</span><span class="p">:</span> <span class="n">OidcAuthenticator</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">auto_renew_from_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fallback_refresh_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">oidc_auth_renewer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OidcAuthenticator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate through OIDC and set up bearer token (based on OIDC access_token) for further requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_refresh_token</span> <span class="o">=</span> <span class="n">store_refresh_token</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">oidc_auth_renewer</span> <span class="ow">and</span> <span class="n">auto_renew_from_refresh_token</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">authenticator</span><span class="o">.</span><span class="n">get_tokens</span><span class="p">(</span><span class="n">request_refresh_token</span><span class="o">=</span><span class="n">request_refresh_token</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Obtained tokens: </span><span class="si">{t}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tokens</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]))</span>

        <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">refresh_token</span> <span class="ow">or</span> <span class="n">fallback_refresh_token</span>
        <span class="k">if</span> <span class="n">store_refresh_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">refresh_token</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_refresh_token_store</span><span class="p">()</span><span class="o">.</span><span class="n">set_refresh_token</span><span class="p">(</span>
                    <span class="n">issuer</span><span class="o">=</span><span class="n">authenticator</span><span class="o">.</span><span class="n">provider_info</span><span class="o">.</span><span class="n">issuer</span><span class="p">,</span>
                    <span class="n">client_id</span><span class="o">=</span><span class="n">authenticator</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
                    <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No OIDC refresh token to store.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">oidc_auth_renewer</span> <span class="ow">and</span> <span class="n">auto_renew_from_refresh_token</span> <span class="ow">and</span> <span class="n">refresh_token</span><span class="p">:</span>
            <span class="n">oidc_auth_renewer</span> <span class="o">=</span> <span class="n">OidcRefreshTokenAuthenticator</span><span class="p">(</span>
                <span class="n">client_info</span><span class="o">=</span><span class="n">authenticator</span><span class="o">.</span><span class="n">client_info</span><span class="p">,</span> <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span>
            <span class="p">)</span>

        <span class="n">token</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">access_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">OidcBearerAuth</span><span class="p">(</span><span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">access_token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span> <span class="o">=</span> <span class="n">oidc_auth_renewer</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Connection.authenticate_oidc_authorization_code">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_authorization_code">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_authorization_code</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">server_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">webbrowser_open</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        OpenID Connect Authorization Code Flow (with PKCE).</span>

<span class="sd">        .. deprecated:: 0.19.0</span>
<span class="sd">            Usage of the Authorization Code flow is deprecated (because of its complexity) and will be removed.</span>
<span class="sd">            It is recommended to use the Device Code flow  with :py:meth:`Connection.authenticate_oidc_device`</span>
<span class="sd">            or Client Credentials flow with :py:meth:`Connection.authenticate_oidc_client_credentials`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">default_client_grant_check</span><span class="o">=</span><span class="p">[</span><span class="n">DefaultOidcClientGrant</span><span class="o">.</span><span class="n">AUTH_CODE_PKCE</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcAuthCodePkceAuthenticator</span><span class="p">(</span>
            <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span>
            <span class="n">webbrowser_open</span><span class="o">=</span><span class="n">webbrowser_open</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="n">server_address</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span><span class="n">authenticator</span><span class="p">,</span> <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc_client_credentials">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_client_credentials">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_client_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate with :ref:`OIDC Client Credentials flow &lt;authenticate_oidc_client_credentials&gt;`</span>

<span class="sd">        Client id, secret and provider id can be specified directly through the available arguments.</span>
<span class="sd">        It is also possible to leave these arguments empty and specify them through</span>
<span class="sd">        environment variables ``OPENEO_AUTH_CLIENT_ID``,</span>
<span class="sd">        ``OPENEO_AUTH_CLIENT_SECRET`` and ``OPENEO_AUTH_PROVIDER_ID`` respectively</span>
<span class="sd">        as discussed in :ref:`authenticate_oidc_client_credentials_env_vars`.</span>

<span class="sd">        :param client_id: client id to use</span>
<span class="sd">        :param client_secret: client secret to use</span>
<span class="sd">        :param provider_id: provider id to use</span>
<span class="sd">            Fallback value can be set through environment variable ``OPENEO_AUTH_PROVIDER_ID``.</span>

<span class="sd">        .. versionchanged:: 0.18.0 Allow specifying client id, secret and provider id through environment variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: option to get client id/secret from a config file too?</span>
        <span class="k">if</span> <span class="n">client_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;OPENEO_AUTH_CLIENT_ID&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="s2">&quot;OPENEO_AUTH_CLIENT_SECRET&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">client_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPENEO_AUTH_CLIENT_ID&quot;</span><span class="p">)</span>
            <span class="n">client_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPENEO_AUTH_CLIENT_SECRET&quot;</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting client id (</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">) and secret from environment&quot;</span><span class="p">)</span>

        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span>
        <span class="p">)</span>
        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcClientCredentialsAuthenticator</span><span class="p">(</span><span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
            <span class="n">authenticator</span><span class="p">,</span> <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">store_refresh_token</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">oidc_auth_renewer</span><span class="o">=</span><span class="n">authenticator</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc_resource_owner_password_credentials">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_resource_owner_password_credentials">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_resource_owner_password_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        OpenId Connect Resource Owner Password Credentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span>
        <span class="p">)</span>
        <span class="c1"># TODO: also get username and password from config?</span>
        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcResourceOwnerPasswordAuthenticator</span><span class="p">(</span>
            <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
            <span class="n">authenticator</span><span class="p">,</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span>
            <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
            <span class="n">oidc_auth_renewer</span><span class="o">=</span><span class="n">authenticator</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc_refresh_token">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_refresh_token">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_refresh_token</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refresh_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate with :ref:`OIDC Refresh Token flow &lt;authenticate_oidc_client_credentials&gt;`</span>

<span class="sd">        :param client_id: client id to use</span>
<span class="sd">        :param refresh_token: refresh token to use</span>
<span class="sd">        :param client_secret: client secret to use</span>
<span class="sd">        :param provider_id: provider id to use.</span>
<span class="sd">            Fallback value can be set through environment variable ``OPENEO_AUTH_PROVIDER_ID``.</span>
<span class="sd">        :param store_refresh_token: whether to store the received refresh token automatically</span>

<span class="sd">        .. versionchanged:: 0.19.0 Support fallback provider id through environment variable ``OPENEO_AUTH_PROVIDER_ID``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">default_client_grant_check</span><span class="o">=</span><span class="p">[</span><span class="n">DefaultOidcClientGrant</span><span class="o">.</span><span class="n">REFRESH_TOKEN</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">refresh_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refresh_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_refresh_token_store</span><span class="p">()</span><span class="o">.</span><span class="n">get_refresh_token</span><span class="p">(</span>
                <span class="n">issuer</span><span class="o">=</span><span class="n">client_info</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">issuer</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="n">client_info</span><span class="o">.</span><span class="n">client_id</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">refresh_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;No refresh token given or found&quot;</span><span class="p">)</span>

        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcRefreshTokenAuthenticator</span><span class="p">(</span><span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span> <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
            <span class="n">authenticator</span><span class="p">,</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span>
            <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
            <span class="n">fallback_refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">,</span>
            <span class="n">oidc_auth_renewer</span><span class="o">=</span><span class="n">authenticator</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc_device">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_device">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_device</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_pkce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_poll_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">OidcDeviceAuthenticator</span><span class="o">.</span><span class="n">DEFAULT_MAX_POLL_TIME</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate with the :ref:`OIDC Device Code flow &lt;authenticate_oidc_device&gt;`</span>

<span class="sd">        :param client_id: client id to use instead of the default one</span>
<span class="sd">        :param client_secret: client secret to use instead of the default one</span>
<span class="sd">        :param provider_id: provider id to use.</span>
<span class="sd">            Fallback value can be set through environment variable ``OPENEO_AUTH_PROVIDER_ID``.</span>
<span class="sd">        :param store_refresh_token: whether to store the received refresh token automatically</span>
<span class="sd">        :param use_pkce: Use PKCE instead of client secret.</span>
<span class="sd">            If not set explicitly to `True` (use PKCE) or `False` (use client secret),</span>
<span class="sd">            it will be attempted to detect the best mode automatically.</span>
<span class="sd">            Note that PKCE for device code is not widely supported among OIDC providers.</span>
<span class="sd">        :param max_poll_time: maximum time in seconds to keep polling for successful authentication.</span>

<span class="sd">        .. versionchanged:: 0.5.1 Add :py:obj:`use_pkce` argument</span>
<span class="sd">        .. versionchanged:: 0.17.0 Add :py:obj:`max_poll_time` argument</span>
<span class="sd">        .. versionchanged:: 0.19.0 Support fallback provider id through environment variable ``OPENEO_AUTH_PROVIDER_ID``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_g</span> <span class="o">=</span> <span class="n">DefaultOidcClientGrant</span>  <span class="c1"># alias for compactness</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">default_client_grant_check</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">grants</span><span class="p">:</span> <span class="n">_g</span><span class="o">.</span><span class="n">DEVICE_CODE</span> <span class="ow">in</span> <span class="n">grants</span> <span class="ow">or</span> <span class="n">_g</span><span class="o">.</span><span class="n">DEVICE_CODE_PKCE</span> <span class="ow">in</span> <span class="n">grants</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcDeviceAuthenticator</span><span class="p">(</span>
            <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span> <span class="n">use_pkce</span><span class="o">=</span><span class="n">use_pkce</span><span class="p">,</span> <span class="n">max_poll_time</span><span class="o">=</span><span class="n">max_poll_time</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
            <span class="n">authenticator</span><span class="p">,</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span>
            <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
            <span class="c1"># TODO: expose `auto_renew_from_refresh_token` directly as option instead of reusing `store_refresh_token` arg?</span>
            <span class="n">auto_renew_from_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">store_refresh_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_pkce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">display</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="nb">print</span><span class="p">,</span>
        <span class="n">max_poll_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">OidcDeviceAuthenticator</span><span class="o">.</span><span class="n">DEFAULT_MAX_POLL_TIME</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generic method to do OpenID Connect authentication.</span>

<span class="sd">        In the context of interactive usage, this method first tries to use refresh tokens</span>
<span class="sd">        and falls back on device code flow.</span>

<span class="sd">        For non-interactive, machine-to-machine contexts, it is also possible to trigger</span>
<span class="sd">        the usage of the &quot;client_credentials&quot; flow through environment variables.</span>
<span class="sd">        Assuming you have set up a OIDC client (with a secret):</span>
<span class="sd">        set ``OPENEO_AUTH_METHOD`` to ``client_credentials``,</span>
<span class="sd">        set ``OPENEO_AUTH_CLIENT_ID`` to the client id,</span>
<span class="sd">        and set ``OPENEO_AUTH_CLIENT_SECRET`` to the client secret.</span>

<span class="sd">        See :ref:`authenticate_oidc_automatic` for more details.</span>

<span class="sd">        :param provider_id: provider id to use</span>
<span class="sd">        :param client_id: client id to use</span>
<span class="sd">        :param client_secret: client secret to use</span>
<span class="sd">        :param max_poll_time: maximum time in seconds to keep polling for successful authentication.</span>

<span class="sd">        .. versionadded:: 0.6.0</span>
<span class="sd">        .. versionchanged:: 0.17.0 Add :py:obj:`max_poll_time` argument</span>
<span class="sd">        .. versionchanged:: 0.18.0 Add support for client credentials flow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: unify `os.environ.get` with `get_config_option`?</span>
        <span class="c1"># TODO also support OPENEO_AUTH_CLIENT_ID, ... env vars for refresh token and device code auth?</span>

        <span class="n">auth_method</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OPENEO_AUTH_METHOD&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;authenticate_oidc: going for &#39;client_credentials&#39; authentication&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">authenticate_oidc_client_credentials</span><span class="p">(</span>
                <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span> <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">auth_method</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhandled auth method </span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_g</span> <span class="o">=</span> <span class="n">DefaultOidcClientGrant</span>  <span class="c1"># alias for compactness</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider_and_client_info</span><span class="p">(</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">default_client_grant_check</span><span class="o">=</span><span class="k">lambda</span> <span class="n">grants</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">_g</span><span class="o">.</span><span class="n">REFRESH_TOKEN</span> <span class="ow">in</span> <span class="n">grants</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_g</span><span class="o">.</span><span class="n">DEVICE_CODE</span> <span class="ow">in</span> <span class="n">grants</span> <span class="ow">or</span> <span class="n">_g</span><span class="o">.</span><span class="n">DEVICE_CODE_PKCE</span> <span class="ow">in</span> <span class="n">grants</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Try refresh token first.</span>
        <span class="n">refresh_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_refresh_token_store</span><span class="p">()</span><span class="o">.</span><span class="n">get_refresh_token</span><span class="p">(</span>
            <span class="n">issuer</span><span class="o">=</span><span class="n">client_info</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">issuer</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">client_info</span><span class="o">.</span><span class="n">client_id</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh_token</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found refresh token: trying refresh token based authentication.&quot;</span><span class="p">)</span>
                <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcRefreshTokenAuthenticator</span><span class="p">(</span><span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span> <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">)</span>
                <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
                    <span class="n">authenticator</span><span class="p">,</span>
                    <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span>
                    <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
                    <span class="n">fallback_refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">,</span>
                    <span class="n">oidc_auth_renewer</span><span class="o">=</span><span class="n">authenticator</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># TODO: pluggable/jupyter-aware display function?</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authenticated using refresh token.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">con</span>
            <span class="k">except</span> <span class="n">OidcException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Refresh token based authentication failed: </span><span class="si">{e}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">))</span>

        <span class="c1"># Fall back on device code flow</span>
        <span class="c1"># TODO: make it possible to do other fallback flows too?</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Trying device code flow.&quot;</span><span class="p">)</span>
        <span class="n">authenticator</span> <span class="o">=</span> <span class="n">OidcDeviceAuthenticator</span><span class="p">(</span>
            <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">,</span> <span class="n">use_pkce</span><span class="o">=</span><span class="n">use_pkce</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">max_poll_time</span><span class="o">=</span><span class="n">max_poll_time</span>
        <span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
            <span class="n">authenticator</span><span class="p">,</span>
            <span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span>
            <span class="n">store_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
            <span class="c1"># TODO: expose `auto_renew_from_refresh_token` directly as option instead of reusing `store_refresh_token` arg?</span>
            <span class="n">auto_renew_from_refresh_token</span><span class="o">=</span><span class="n">store_refresh_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Authenticated using device code flow.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">con</span></div>


<div class="viewcode-block" id="Connection.authenticate_oidc_access_token">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_oidc_access_token">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_oidc_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up authorization headers directly with an OIDC access token.</span>

<span class="sd">        :py:class:`Connection` provides multiple methods to handle various OIDC authentication flows end-to-end.</span>
<span class="sd">        If you already obtained a valid OIDC access token in another &quot;out-of-band&quot; way, you can use this method to</span>
<span class="sd">        set up the authorization headers appropriately.</span>

<span class="sd">        :param access_token: OIDC access token</span>
<span class="sd">        :param provider_id: id of the OIDC provider as listed by the openEO backend (``/credentials/oidc``).</span>
<span class="sd">            If not specified, the first (default) OIDC provider will be used.</span>

<span class="sd">        .. versionadded:: 0.31.0</span>

<span class="sd">        .. versionchanged:: 0.33.0</span>
<span class="sd">            Return connection object to support chaining.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provider_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oidc_provider</span><span class="p">(</span><span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">parse_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">OidcBearerAuth</span><span class="p">(</span><span class="n">provider_id</span><span class="o">=</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Connection.authenticate_bearer_token">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.authenticate_bearer_token">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_bearer_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bearer_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up authorization headers directly with a bearer token.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This helper is for advanced usage only.</span>
<span class="sd">            In general, it is recommended to use the more standard OIDC authentication methods</span>
<span class="sd">            like :py:meth:`Connection.authenticate_oidc`.</span>

<span class="sd">        :param bearer_token: openEO-style bearer token.</span>

<span class="sd">        .. versionadded:: 0.38.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">BearerAuth</span><span class="p">(</span><span class="n">bearer</span><span class="o">=</span><span class="n">bearer_token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Connection.try_access_token_refresh">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.try_access_token_refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">try_access_token_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to get a fresh access token if possible.</span>
<span class="sd">        Returns whether a new access token was obtained.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Reason: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">reason</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth</span><span class="p">,</span> <span class="n">OidcBearerAuth</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate_oidc</span><span class="p">(</span>
                    <span class="n">authenticator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="p">,</span>
                    <span class="n">provider_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="o">.</span><span class="n">provider_info</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">store_refresh_token</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">oidc_auth_renewer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Obtained new access token (grant </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="o">.</span><span class="n">grant_type</span><span class="si">!r}</span><span class="s2">).</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">OpenEoClientException</span> <span class="k">as</span> <span class="n">auth_exc</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to obtain new access token (grant </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_oidc_auth_renewer</span><span class="o">.</span><span class="n">grant_type</span><span class="si">!r}</span><span class="s2">): </span><span class="si">{</span><span class="n">auth_exc</span><span class="si">!r}</span><span class="s2">.</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Connection.request">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.request">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AuthBase</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">check_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expected_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Do request, but with retry when access token has expired and refresh token is available.</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_request</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Connection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
                <span class="n">check_error</span><span class="o">=</span><span class="n">check_error</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="n">expected_status</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Initial request attempt</span>
            <span class="k">return</span> <span class="n">_request</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OpenEoApiError</span> <span class="k">as</span> <span class="n">api_exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">api_exc</span><span class="o">.</span><span class="n">http_status_code</span> <span class="ow">in</span> <span class="p">{</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span> <span class="n">HTTP_403_FORBIDDEN</span><span class="p">}</span>
                <span class="ow">and</span> <span class="n">api_exc</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s2">&quot;TokenInvalid&quot;</span>
            <span class="p">):</span>
                <span class="c1"># Retry if we can refresh the access token</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_access_token_refresh</span><span class="p">(</span>
                    <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;OIDC access token expired (</span><span class="si">{</span><span class="n">api_exc</span><span class="o">.</span><span class="n">http_status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">api_exc</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="n">_request</span><span class="p">()</span>
            <span class="k">raise</span></div>


<div class="viewcode-block" id="Connection.describe_account">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.describe_account">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">describe_account</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Describes the currently authenticated user account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/me&#39;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>


<div class="viewcode-block" id="Connection.user_jobs">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.user_jobs">[docs]</a>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;use :py:meth:`list_jobs` instead&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.4.10&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">user_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_jobs</span><span class="p">()</span></div>


<div class="viewcode-block" id="Connection.list_collections">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_collections">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CollectionListingResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List basic metadata of all collections provided by the back-end.</span>

<span class="sd">        .. caution::</span>

<span class="sd">            Only the basic collection metadata will be returned.</span>
<span class="sd">            To obtain full metadata of a particular collection,</span>
<span class="sd">            it is recommended to use :py:meth:`~openeo.rest.connection.Connection.describe_collection` instead.</span>

<span class="sd">        :return: list of dictionaries with basic collection metadata.</span>

<span class="sd">        .. versionchanged:: 0.38.0</span>
<span class="sd">            Returns a :py:class:`~openeo.rest.models.general.CollectionListingResponse` object</span>
<span class="sd">            instead of a simple ``List[dict]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add caching #383, but reset cache on auth change #254</span>
        <span class="c1"># TODO #677 add pagination support?</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/collections&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CollectionListingResponse</span><span class="p">(</span><span class="n">response_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.list_collection_ids">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_collection_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_collection_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all collection ids provided by the back-end.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :py:meth:`~openeo.rest.connection.Connection.describe_collection`</span>
<span class="sd">            to get the metadata of a particular collection.</span>

<span class="sd">        :return: list of collection ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">collection</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_collections</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">]</span></div>


<div class="viewcode-block" id="Connection.capabilities">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.capabilities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpenEoCapabilities</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the openEO capabilities document.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;capabilities&quot;</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">OpenEoCapabilities</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_url</span><span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">list_input_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_file_formats</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_output_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_file_formats</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="n">list_file_types</span> <span class="o">=</span> <span class="n">legacy_alias</span><span class="p">(</span>
        <span class="n">list_output_formats</span><span class="p">,</span> <span class="s2">&quot;list_file_types&quot;</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;0.4.6&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="Connection.list_file_formats">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_file_formats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_file_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get available input and output formats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;file_formats&quot;</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/file_formats&#39;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">federation_missing</span> <span class="o">=</span> <span class="n">federation_extension</span><span class="o">.</span><span class="n">get_federation_missing</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">formats</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="s2">&quot;file_formats&quot;</span><span class="p">)</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">VisualDict</span><span class="p">(</span>
            <span class="s2">&quot;file-formats&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">formats</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;missing&quot;</span><span class="p">:</span> <span class="n">federation_missing</span><span class="p">,</span> <span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.list_service_types">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_service_types">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_service_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all available service types.</span>

<span class="sd">        :return: data_dict: Dict All available service types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;service_types&quot;</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/service_types&#39;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">VisualDict</span><span class="p">(</span><span class="s2">&quot;service-types&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">types</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.list_udf_runtimes">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_udf_runtimes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_udf_runtimes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List information about the available UDF runtimes.</span>

<span class="sd">        :return: A dictionary with metadata about each available UDF runtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runtimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;udf_runtimes&quot;</span><span class="p">,</span>
            <span class="n">load</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/udf_runtimes&#39;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">VisualDict</span><span class="p">(</span><span class="s2">&quot;udf-runtimes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">runtimes</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">})</span></div>


<div class="viewcode-block" id="Connection.list_services">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_services">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_services</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all available services of the authenticated user.</span>

<span class="sd">        :return: data_dict: Dict All available services</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO return parsed service objects</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/services&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">federation_missing</span> <span class="o">=</span> <span class="n">federation_extension</span><span class="o">.</span><span class="n">get_federation_missing</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="s2">&quot;services&quot;</span><span class="p">)</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">VisualList</span><span class="p">(</span>
            <span class="s2">&quot;data-table&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;services&quot;</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="s2">&quot;services&quot;</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span> <span class="n">federation_missing</span><span class="p">,</span> <span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.describe_collection">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.describe_collection">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">describe_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get full collection metadata for given collection id.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :py:meth:`~openeo.rest.connection.Connection.list_collection_ids`</span>
<span class="sd">            to list all collection ids provided by the back-end.</span>

<span class="sd">        :param collection_id: collection id</span>
<span class="sd">        :return: collection metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: duplication with `Connection.collection_metadata`: deprecate one or the other?</span>
        <span class="c1"># TODO: add caching #383</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/collections/</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">VisualDict</span><span class="p">(</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">})</span></div>


<div class="viewcode-block" id="Connection.collection_items">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.collection_items">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">collection_items</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">spatial_extent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_extent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads items for a specific image collection.</span>
<span class="sd">        May not be available for all collections.</span>

<span class="sd">        This is an experimental API and is subject to change.</span>

<span class="sd">        :param name: String Id of the collection</span>
<span class="sd">        :param spatial_extent: Limits the items to the given bounding box in WGS84:</span>
<span class="sd">            1. Lower left corner, coordinate axis 1</span>
<span class="sd">            2. Lower left corner, coordinate axis 2</span>
<span class="sd">            3. Upper right corner, coordinate axis 1</span>
<span class="sd">            4. Upper right corner, coordinate axis 2</span>

<span class="sd">        :param temporal_extent: Limits the items to the specified temporal interval.</span>
<span class="sd">        :param limit: The amount of items per request/page. If None, the back-end decides.</span>
<span class="sd">            The interval has to be specified as an array with exactly two elements (start, end).</span>
<span class="sd">            Also supports open intervals by setting one of the boundaries to None, but never both.</span>

<span class="sd">        :return: data_list: List A list of items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;/collections/</span><span class="si">{}</span><span class="s1">/items&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">spatial_extent</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">spatial_extent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temporal_extent</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rfc3339</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">temporal_extent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">paginate</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">response</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="n">VisualDict</span><span class="p">(</span>
                <span class="s2">&quot;items&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;show-map&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;heading&quot;</span><span class="p">:</span> <span class="s2">&quot;Page </span><span class="si">{}</span><span class="s2"> - Items&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="p">),</span> <span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">},</span>
            <span class="p">),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">collection_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CollectionMetadata</span><span class="p">:</span>
        <span class="c1"># TODO: duplication with `Connection.describe_collection`: deprecate one or the other?</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CollectionMetadata</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">describe_collection</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">_federation</span><span class="o">=</span><span class="n">federation</span><span class="p">)</span>

<div class="viewcode-block" id="Connection.list_processes">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_processes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessListingResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all available processes of the back end.</span>

<span class="sd">        :param namespace: The namespace for which to list processes.</span>

<span class="sd">        :return: listing of available processes</span>

<span class="sd">        .. versionchanged:: 0.38.0</span>
<span class="sd">            Returns a :py:class:`~openeo.rest.models.general.ProcessListingResponse` object</span>
<span class="sd">            instead of a simple ``List[dict]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Maybe format the result dictionary so that the process_id is the key of the dictionary.</span>
        <span class="c1"># TODO #677 add pagination support?</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;processes&quot;</span><span class="p">,</span> <span class="s2">&quot;backend&quot;</span><span class="p">),</span> <span class="n">load</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/processes&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/processes/&quot;</span> <span class="o">+</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ProcessListingResponse</span><span class="p">(</span><span class="n">response_data</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.describe_process">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.describe_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">describe_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a single process from the back end.</span>

<span class="sd">        :param id: The id of the process.</span>
<span class="sd">        :param namespace: The namespace of the process.</span>

<span class="sd">        :return: The process definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_processes</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">VisualDict</span><span class="p">(</span>
                    <span class="s2">&quot;process&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
                    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;show-graph&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;provide-download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">},</span>
                <span class="p">)</span>

        <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;Process does not exist.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.list_jobs">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_jobs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobListingResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists (batch) jobs metadata of the authenticated user.</span>

<span class="sd">        :param limit: maximum number of jobs to return (with pagination).</span>
<span class="sd">            Can be set to ``None`` to disable pagination,</span>
<span class="sd">            but note that the backend might still silently cap the listing in practice.</span>

<span class="sd">        :return: job_list: Dict of all jobs of the user.</span>

<span class="sd">        .. versionchanged:: 0.36.0</span>
<span class="sd">            Added ``limit`` argument</span>

<span class="sd">        .. versionchanged:: 0.38.0</span>
<span class="sd">            Returns a :py:class:`~openeo.rest.models.general.JobListingResponse` object</span>
<span class="sd">            instead of simple ``List[dict]``.</span>

<span class="sd">        .. versionchanged:: 0.41.0</span>
<span class="sd">            Change default value of ``limit`` to 100 (instead of unlimited).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Parse the result so that Job classes returned?</span>
        <span class="c1"># TODO: when pagination is enabled: how to expose link to next page?</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/jobs&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">},</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">JobListingResponse</span><span class="p">(</span><span class="n">response_data</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.assert_user_defined_process_support">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.assert_user_defined_process_support">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assert_user_defined_process_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capabilities document based verification that back-end supports user-defined processes.</span>

<span class="sd">        .. versionadded:: 0.23.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">supports_endpoint</span><span class="p">(</span><span class="s2">&quot;/process_graphs&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CapabilitiesException</span><span class="p">(</span><span class="s2">&quot;Backend does not support user-defined processes.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.save_user_defined_process">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.save_user_defined_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_user_defined_process</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">user_defined_process_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">process_graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">ProcessBuilderBase</span><span class="p">],</span>
            <span class="n">parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">summary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">categories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">examples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">links</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RESTUserDefinedProcess</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a process graph and its metadata on the backend as a user-defined process for the authenticated user.</span>

<span class="sd">        :param user_defined_process_id: unique identifier for the user-defined process</span>
<span class="sd">        :param process_graph: a process graph</span>
<span class="sd">        :param parameters: a list of parameters</span>
<span class="sd">        :param public: visible to other users?</span>
<span class="sd">        :param summary: A short summary of what the process does.</span>
<span class="sd">        :param description: Detailed description to explain the entity. CommonMark 0.29 syntax MAY be used for rich text representation.</span>
<span class="sd">        :param returns: Description and schema of the return value.</span>
<span class="sd">        :param categories: A list of categories.</span>
<span class="sd">        :param examples: A list of examples.</span>
<span class="sd">        :param links: A list of links.</span>
<span class="sd">        :return: a RESTUserDefinedProcess instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_user_defined_process_support</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user_defined_process_id</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_processes</span><span class="p">()):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Defining user-defined process </span><span class="si">{u!r}</span><span class="s2"> with same id as a pre-defined process&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">u</span><span class="o">=</span><span class="n">user_defined_process_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Defining user-defined process </span><span class="si">{u!r}</span><span class="s2"> without parameters&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">user_defined_process_id</span><span class="p">))</span>
        <span class="n">udp</span> <span class="o">=</span> <span class="n">RESTUserDefinedProcess</span><span class="p">(</span><span class="n">user_defined_process_id</span><span class="o">=</span><span class="n">user_defined_process_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">udp</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="n">process_graph</span><span class="o">=</span><span class="n">process_graph</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">public</span><span class="o">=</span><span class="n">public</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">returns</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span> <span class="n">examples</span><span class="o">=</span><span class="n">examples</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="n">links</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">udp</span></div>


<div class="viewcode-block" id="Connection.list_user_defined_processes">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_user_defined_processes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_user_defined_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessListingResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists all user-defined processes of the authenticated user.</span>

<span class="sd">        .. versionchanged:: 0.38.0</span>
<span class="sd">            Returns a :py:class:`~openeo.rest.models.general.ProcessListingResponse` object</span>
<span class="sd">            instead of a simple ``List[dict]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO #677 add pagination support?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_user_defined_process_support</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/process_graphs&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ProcessListingResponse</span><span class="p">(</span><span class="n">response_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.user_defined_process">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.user_defined_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">user_defined_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_defined_process_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RESTUserDefinedProcess</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the user-defined process based on its id. The process with the given id should already exist.</span>

<span class="sd">        :param user_defined_process_id: the id of the user-defined process</span>
<span class="sd">        :return: a RESTUserDefinedProcess instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">RESTUserDefinedProcess</span><span class="p">(</span><span class="n">user_defined_process_id</span><span class="o">=</span><span class="n">user_defined_process_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.validate_process_graph">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.validate_process_graph">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_process_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">process_graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FlatGraphableMixin</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValidationResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate a process graph without executing it.</span>

<span class="sd">        :param process_graph: openEO-style (flat) process graph representation,</span>
<span class="sd">            or an object that can be converted to such a representation:</span>
<span class="sd">            a dictionary, a :py:class:`~openeo.rest.datacube.DataCube` object,</span>
<span class="sd">            a string with a JSON representation,</span>
<span class="sd">            a local file path or URL to a JSON representation,</span>
<span class="sd">            a :py:class:`~openeo.rest.multiresult.MultiResult` object, ...</span>

<span class="sd">        :return: container of validation errors (dictionaries with &quot;code&quot; and &quot;message&quot; fields)</span>

<span class="sd">        .. versionchanged:: 0.38.0</span>
<span class="sd">            returns a :py:class:`~openeo.rest.models.general.ValidationResponse` object</span>
<span class="sd">            instead of a simple list of error dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span><span class="n">process_graph</span><span class="p">)[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/validation&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ValidationResponse</span><span class="p">(</span><span class="n">response_data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_api_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComparableVersion</span><span class="p">:</span>
        <span class="c1"># TODO make this a public property (it&#39;s also useful outside the Connection class)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">api_version_check</span>

<div class="viewcode-block" id="Connection.vectorcube_from_paths">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.vectorcube_from_paths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">vectorcube_from_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads one or more files referenced by url or path that is accessible by the backend.</span>

<span class="sd">        :param paths: The files to read.</span>
<span class="sd">        :param format:  The file format to read from. It must be one of the values that the server reports as supported input file formats.</span>
<span class="sd">        :param options: The file format parameters to be used to read the files. Must correspond to the parameters that the server reports as supported parameters for the chosen format.</span>

<span class="sd">        :return: A :py:class:`VectorCube`.</span>

<span class="sd">        .. versionadded:: 0.14.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO #457 deprecate this in favor of `load_url` and standard support for `load_uploaded_files`</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">PGNode</span><span class="p">(</span>
            <span class="s2">&quot;load_uploaded_files&quot;</span><span class="p">,</span>
            <span class="n">arguments</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># TODO: load_uploaded_files might also return a raster data cube. Determine this based on format?</span>
        <span class="k">return</span> <span class="n">VectorCube</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.datacube_from_process">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.datacube_from_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datacube_from_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a data cube from a (custom) process.</span>

<span class="sd">        :param process_id: The process id.</span>
<span class="sd">        :param namespace: optional: process namespace</span>
<span class="sd">        :param kwargs: The arguments of the custom process</span>
<span class="sd">        :return: A :py:class:`DataCube`, without valid metadata, as the client is not aware of this custom process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">PGNode</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DataCube</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.datacube_from_flat_graph">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.datacube_from_flat_graph">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datacube_from_flat_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">flat_graph</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataCube</span><span class="p">,</span> <span class="n">SaveResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a :py:class:`~openeo.rest.datacube.DataCube`/:py:class:`~openeo.rest.result.SaveResult`</span>
<span class="sd">        from the operations encoded in a flat dictionary representation of an openEO process graph.</span>

<span class="sd">        .. seealso:: :ref:`datacube_from_json`, :py:meth:`~openeo.rest.connection.Connection.datacube_from_json`</span>

<span class="sd">        :param flat_graph: flat dictionary representation of a process graph</span>
<span class="sd">            or a process dictionary with such a flat process graph under a &quot;process_graph&quot; field</span>
<span class="sd">            (and optionally parameter metadata under a &quot;parameters&quot; field).</span>
<span class="sd">        :param parameters: Optional dictionary mapping parameter names to parameter values</span>
<span class="sd">            to use for parameters occurring in the process graph (e.g. as used in user-defined processes)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s2">&quot;process_graph&quot;</span> <span class="ow">in</span> <span class="n">flat_graph</span><span class="p">:</span>
            <span class="c1"># `flat_graph` is a &quot;process&quot; structure</span>
            <span class="c1"># Extract defaults from declared parameters.</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">flat_graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span>

            <span class="n">flat_graph</span> <span class="o">=</span> <span class="n">flat_graph</span><span class="p">[</span><span class="s2">&quot;process_graph&quot;</span><span class="p">]</span>

        <span class="n">pgnode</span> <span class="o">=</span> <span class="n">PGNode</span><span class="o">.</span><span class="n">from_flat_graph</span><span class="p">(</span><span class="n">flat_graph</span><span class="o">=</span><span class="n">flat_graph</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="c1"># TODO #733: smarter or more dynamic detection of what kind of object to return?</span>
        <span class="c1"># TODO #733: rename `datacube_from_flat_graph` to something more general as this is not only about DataCube&#39;s anymore?</span>
        <span class="k">if</span> <span class="n">pgnode</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="s2">&quot;save_result&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SaveResult</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">pgnode</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataCube</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">pgnode</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.datacube_from_json">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.datacube_from_json">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">datacube_from_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataCube</span><span class="p">,</span> <span class="n">SaveResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a :py:class:`~openeo.rest.datacube.DataCube`/:py:class:`~openeo.rest.result.SaveResult`</span>
<span class="sd">        from a JSON resource containing a (flat) openEO process graph representation.</span>

<span class="sd">        .. seealso:: :ref:`datacube_from_json`, :py:meth:`~openeo.rest.connection.Connection.datacube_from_flat_graph`</span>

<span class="sd">        :param src: raw JSON string, URL to JSON resource or path to local JSON file</span>
<span class="sd">        :param parameters: Optional dictionary mapping parameter names to parameter values</span>
<span class="sd">            to use for parameters occurring in the process graph (e.g. as used in user-defined processes)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datacube_from_flat_graph</span><span class="p">(</span><span class="n">load_json_resource</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.load_collection">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_collection">[docs]</a>
    <span class="nd">@openeo_process</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">],</span>
        <span class="n">spatial_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseGeometry</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputDate</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">_FromNodeMixin</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">_FromNodeMixin</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">PGNode</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">CollectionProperty</span><span class="p">],</span> <span class="n">CollectionProperty</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_cloud_cover</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fetch_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a DataCube by collection id.</span>

<span class="sd">        :param collection_id: image collection identifier</span>
<span class="sd">        :param spatial_extent: limit data to specified bounding box or polygons. Can be provided in different ways:</span>

<span class="sd">            - a bounding box dictionary</span>
<span class="sd">            - a Shapely geometry object</span>
<span class="sd">            - a GeoJSON-style dictionary</span>
<span class="sd">            - a path (as :py:class:`str` or :py:class:`~pathlib.Path`) to a local, client-side GeoJSON file,</span>
<span class="sd">              which will be loaded automatically to get the geometries as GeoJSON construct.</span>
<span class="sd">            - a URL to a publicly accessible GeoJSON document</span>
<span class="sd">            - a :py:class:`~openeo.api.process.Parameter` instance.</span>

<span class="sd">        :param temporal_extent: limit data to specified temporal interval.</span>
<span class="sd">            Typically, just a two-item list or tuple containing start and end date.</span>
<span class="sd">            See :ref:`filtering-on-temporal-extent-section` for more details on temporal extent handling and shorthand notation.</span>
<span class="sd">        :param bands: only add the specified bands.</span>
<span class="sd">        :param properties: limit data by collection metadata property predicates.</span>
<span class="sd">            See :py:func:`~openeo.rest.graph_building.collection_property` for easy construction of such predicates.</span>
<span class="sd">        :param max_cloud_cover: shortcut to set maximum cloud cover (&quot;eo:cloud_cover&quot; collection property)</span>
<span class="sd">        :return: a datacube containing the requested data</span>

<span class="sd">        .. versionadded:: 0.13.0</span>
<span class="sd">            added the ``max_cloud_cover`` argument.</span>

<span class="sd">        .. versionchanged:: 0.23.0</span>
<span class="sd">            Argument ``temporal_extent``: add support for year/month shorthand notation</span>
<span class="sd">            as discussed at :ref:`date-shorthand-handling`.</span>

<span class="sd">        .. versionchanged:: 0.26.0</span>
<span class="sd">            Add :py:func:`~openeo.rest.graph_building.collection_property` support to ``properties`` argument.</span>

<span class="sd">        .. versionchanged:: 0.37.0</span>
<span class="sd">            Argument ``spatial_extent``: add support for passing a Shapely geometry or a local path to a GeoJSON file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataCube</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
            <span class="n">collection_id</span><span class="o">=</span><span class="n">collection_id</span><span class="p">,</span>
            <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
            <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">max_cloud_cover</span><span class="o">=</span><span class="n">max_cloud_cover</span><span class="p">,</span>
            <span class="n">fetch_metadata</span><span class="o">=</span><span class="n">fetch_metadata</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1"># TODO: remove this #100 #134 0.4.10</span>
    <span class="n">imagecollection</span> <span class="o">=</span> <span class="n">legacy_alias</span><span class="p">(</span>
        <span class="n">load_collection</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;imagecollection&quot;</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;0.4.10&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="Connection.load_result">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_result">[docs]</a>
    <span class="nd">@openeo_process</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">spatial_extent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputDate</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads batch job results by job id from the server-side user workspace.</span>
<span class="sd">        The job must have been stored by the authenticated user on the back-end currently connected to.</span>

<span class="sd">        :param id: The id of a batch job with results.</span>
<span class="sd">        :param spatial_extent: limit data to specified bounding box or polygons</span>
<span class="sd">        :param temporal_extent: limit data to specified temporal interval.</span>
<span class="sd">            Typically, just a two-item list or tuple containing start and end date.</span>
<span class="sd">            See :ref:`filtering-on-temporal-extent-section` for more details on temporal extent handling and shorthand notation.</span>
<span class="sd">        :param bands: only add the specified bands</span>

<span class="sd">        :return: a :py:class:`DataCube`</span>

<span class="sd">        .. versionchanged:: 0.23.0</span>
<span class="sd">            Argument ``temporal_extent``: add support for year/month shorthand notation</span>
<span class="sd">            as discussed at :ref:`date-shorthand-handling`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add check that back-end supports `load_result` process?</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datacube_from_process</span><span class="p">(</span>
            <span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;load_result&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">dict_no_none</span><span class="p">(</span>
                <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
                <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span> <span class="ow">and</span> <span class="n">DataCube</span><span class="o">.</span><span class="n">_get_temporal_extent</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">),</span>
                <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cube</span></div>


<div class="viewcode-block" id="Connection.load_stac">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_stac">[docs]</a>
    <span class="nd">@openeo_process</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_stac</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">spatial_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">dict</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseGeometry</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">_FromNodeMixin</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputDate</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">_FromNodeMixin</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">PGNode</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">CollectionProperty</span><span class="p">],</span> <span class="n">CollectionProperty</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads data from a static STAC catalog or a STAC API Collection and returns the data as a processable :py:class:`DataCube`.</span>
<span class="sd">        A batch job result can be loaded by providing a reference to it.</span>

<span class="sd">        If supported by the underlying metadata and file format, the data that is added to the data cube can be</span>
<span class="sd">        restricted with the parameters ``spatial_extent``, ``temporal_extent`` and ``bands``.</span>
<span class="sd">        If no data is available for the given extents, a ``NoDataAvailable`` error is thrown.</span>

<span class="sd">        Remarks:</span>

<span class="sd">        * The bands (and all dimensions that specify nominal dimension labels) are expected to be ordered as</span>
<span class="sd">          specified in the metadata if the ``bands`` parameter is set to ``null``.</span>
<span class="sd">        * If no additional parameter is specified this would imply that the whole data set is expected to be loaded.</span>
<span class="sd">          Due to the large size of many data sets, this is not recommended and may be optimized by back-ends to only</span>
<span class="sd">          load the data that is actually required after evaluating subsequent processes such as filters.</span>
<span class="sd">          This means that the values should be processed only after the data has been limited to the required extent</span>
<span class="sd">          and as a consequence also to a manageable size.</span>


<span class="sd">        :param url: The URL to a static STAC catalog (STAC Item, STAC Collection, or STAC Catalog)</span>
<span class="sd">            or a specific STAC API Collection that allows to filter items and to download assets.</span>
<span class="sd">            This includes batch job results, which itself are compliant to STAC.</span>
<span class="sd">            For external URLs, authentication details such as API keys or tokens may need to be included in the URL.</span>

<span class="sd">            Batch job results can be specified in two ways:</span>

<span class="sd">            - For Batch job results at the same back-end, a URL pointing to the corresponding batch job results</span>
<span class="sd">              endpoint should be provided. The URL usually ends with ``/jobs/{id}/results`` and ``{id}``</span>
<span class="sd">              is the corresponding batch job ID.</span>
<span class="sd">            - For external results, a signed URL must be provided. Not all back-ends support signed URLs,</span>
<span class="sd">              which are provided as a link with the link relation `canonical` in the batch job result metadata.</span>
<span class="sd">        :param spatial_extent:</span>
<span class="sd">            Limits the data to load to the specified bounding box or polygons.</span>

<span class="sd">            For raster data, the process loads the pixel into the data cube if the point at the pixel center intersects</span>
<span class="sd">            with the bounding box or any of the polygons (as defined in the Simple Features standard by the OGC).</span>

<span class="sd">            For vector data, the process loads the geometry into the data cube if the geometry is fully within the</span>
<span class="sd">            bounding box or any of the polygons (as defined in the Simple Features standard by the OGC).</span>
<span class="sd">            Empty geometries may only be in the data cube if no spatial extent has been provided.</span>

<span class="sd">            The GeoJSON can be one of the following feature types:</span>

<span class="sd">            * A ``Polygon`` or ``MultiPolygon`` geometry,</span>
<span class="sd">            * a ``Feature`` with a ``Polygon`` or ``MultiPolygon`` geometry, or</span>
<span class="sd">            * a ``FeatureCollection`` containing at least one ``Feature`` with ``Polygon`` or ``MultiPolygon`` geometries.</span>

<span class="sd">            Set this parameter to ``None`` to set no limit for the spatial extent.</span>
<span class="sd">            Be careful with this when loading large datasets. It is recommended to use this parameter instead of</span>
<span class="sd">            using ``filter_bbox()`` or ``filter_spatial()`` directly after loading unbounded data.</span>

<span class="sd">        :param temporal_extent:</span>
<span class="sd">            Limits the data to load to the specified left-closed temporal interval.</span>
<span class="sd">            Applies to all temporal dimensions.</span>
<span class="sd">            The interval has to be specified as an array with exactly two elements:</span>

<span class="sd">            1.  The first element is the start of the temporal interval.</span>
<span class="sd">                The specified instance in time is **included** in the interval.</span>
<span class="sd">            2.  The second element is the end of the temporal interval.</span>
<span class="sd">                The specified instance in time is **excluded** from the interval.</span>

<span class="sd">            The second element must always be greater/later than the first element.</span>
<span class="sd">            Otherwise, a `TemporalExtentEmpty` exception is thrown.</span>

<span class="sd">            Also supports open intervals by setting one of the boundaries to ``None``, but never both.</span>

<span class="sd">            Set this parameter to ``None`` to set no limit for the temporal extent.</span>
<span class="sd">            Be careful with this when loading large datasets. It is recommended to use this parameter instead of</span>
<span class="sd">            using ``filter_temporal()`` directly after loading unbounded data.</span>

<span class="sd">        :param bands:</span>
<span class="sd">            Only adds the specified bands into the data cube so that bands that don&#39;t match the list</span>
<span class="sd">            of band names are not available. Applies to all dimensions of type `bands`.</span>

<span class="sd">            Either the unique band name (metadata field ``name`` in bands) or one of the common band names</span>
<span class="sd">            (metadata field ``common_name`` in bands) can be specified.</span>
<span class="sd">            If the unique band name and the common name conflict, the unique band name has a higher priority.</span>

<span class="sd">            The order of the specified array defines the order of the bands in the data cube.</span>
<span class="sd">            If multiple bands match a common name, all matched bands are included in the original order.</span>

<span class="sd">            It is recommended to use this parameter instead of using ``filter_bands()`` directly after loading unbounded data.</span>

<span class="sd">        :param properties:</span>
<span class="sd">            Limits the data by metadata properties to include only data in the data cube which</span>
<span class="sd">            all given conditions return ``True`` for (AND operation).</span>

<span class="sd">            Specify key-value-pairs with the key being the name of the metadata property,</span>
<span class="sd">            which can be retrieved with the openEO Data Discovery for Collections.</span>
<span class="sd">            The value must be a condition (user-defined process) to be evaluated against a STAC API.</span>
<span class="sd">            This parameter is not supported for static STAC.</span>

<span class="sd">            See :py:func:`~openeo.rest.graph_building.collection_property` for easy construction of property filters.</span>

<span class="sd">        .. versionadded:: 0.17.0</span>

<span class="sd">        .. versionchanged:: 0.23.0</span>
<span class="sd">            Argument ``temporal_extent``: add support for year/month shorthand notation</span>
<span class="sd">            as discussed at :ref:`date-shorthand-handling`.</span>

<span class="sd">        .. versionchanged:: 0.37.0</span>
<span class="sd">            Argument ``spatial_extent``: add support for passing a Shapely geometry or a local path to a GeoJSON file.</span>

<span class="sd">        .. versionchanged:: 0.41.0</span>
<span class="sd">            Add support for :py:func:`~openeo.rest.graph_building.collection_property` based property filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataCube</span><span class="o">.</span><span class="n">load_stac</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
            <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.load_stac_from_job">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_stac_from_job">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_stac_from_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BatchJob</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">spatial_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">temporal_extent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputDate</span><span class="p">],</span> <span class="n">Parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PGNode</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience function to directly load the results of a finished openEO job</span>
<span class="sd">        (as a STAC collection) with :py:meth:`load_stac` in a new openEO process graph.</span>

<span class="sd">        When available, the &quot;canonical&quot; link (signed URL) of the job results will be used.</span>

<span class="sd">        :param job: a :py:class:`~openeo.rest.job.BatchJob` or job id pointing to a finished job.</span>
<span class="sd">            Note that the  :py:class:`~openeo.rest.job.BatchJob` approach allows to point</span>
<span class="sd">            to a batch job on a different back-end.</span>
<span class="sd">        :param spatial_extent: limit data to specified bounding box or polygons</span>
<span class="sd">        :param temporal_extent: limit data to specified temporal interval.</span>
<span class="sd">        :param bands: limit data to the specified bands</span>

<span class="sd">        .. versionadded:: 0.30.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO #634 add option to require or avoid the canonical link</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">job</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">BatchJob</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;job must be a BatchJob or job id&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">job_results</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>

            <span class="n">canonical_links</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">job_results</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;canonical&quot;</span> <span class="ow">and</span> <span class="s2">&quot;href&quot;</span> <span class="ow">in</span> <span class="n">link</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">canonical_links</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No canonical link found in job results metadata. Using job results URL instead.&quot;</span><span class="p">)</span>
                <span class="n">stac_link</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get_results_metadata_url</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">canonical_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Multiple canonical links found in job results metadata: </span><span class="si">{</span><span class="n">canonical_links</span><span class="si">}</span><span class="s2">. Picking first one.&quot;</span>
                    <span class="p">)</span>
                <span class="n">stac_link</span> <span class="o">=</span> <span class="n">canonical_links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">OpenEoApiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get the canonical job results: </span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2">. Using job results URL instead.&quot;</span><span class="p">)</span>
            <span class="n">stac_link</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get_results_metadata_url</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_stac</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">stac_link</span><span class="p">,</span>
            <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
            <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">,</span>
            <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.load_ml_model">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_ml_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_ml_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BatchJob</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MlModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a machine learning model from a STAC Item.</span>

<span class="sd">        :param id: STAC item reference, as URL, batch job (id) or user-uploaded file</span>
<span class="sd">        :return:</span>

<span class="sd">        .. versionadded:: 0.10.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MlModel</span><span class="o">.</span><span class="n">load_ml_model</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.load_geojson">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_geojson">[docs]</a>
    <span class="nd">@openeo_process</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_geojson</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseGeometry</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">],</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts GeoJSON data as defined by RFC 7946 into a vector data cube.</span>

<span class="sd">        :param data: the geometry to load. One of:</span>

<span class="sd">            - GeoJSON-style data structure: e.g. a dictionary with ``&quot;type&quot;: &quot;Polygon&quot;`` and ``&quot;coordinates&quot;`` fields</span>
<span class="sd">            - a path to a local GeoJSON file</span>
<span class="sd">            - a GeoJSON string</span>
<span class="sd">            - a shapely geometry object</span>

<span class="sd">        :param properties: A list of properties from the GeoJSON file to construct an additional dimension from.</span>
<span class="sd">        :return: new VectorCube instance</span>

<span class="sd">        .. warning:: EXPERIMENTAL: this process is experimental with the potential for major things to change.</span>

<span class="sd">        .. versionadded:: 0.22.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VectorCube</span><span class="o">.</span><span class="n">load_geojson</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.load_url">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.load_url">[docs]</a>
    <span class="nd">@openeo_process</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorCube</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a file from a URL</span>

<span class="sd">        :param url: The URL to read from. Authentication details such as API keys or tokens may need to be included in the URL.</span>
<span class="sd">        :param format: The file format to use when loading the data.</span>
<span class="sd">        :param options: The file format parameters to use when reading the data.</span>
<span class="sd">            Must correspond to the parameters that the server reports as supported parameters for the chosen ``format``</span>
<span class="sd">        :return: new VectorCube instance</span>

<span class="sd">        .. warning:: EXPERIMENTAL: this process is experimental with the potential for major things to change.</span>

<span class="sd">        .. versionadded:: 0.22.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_input_formats</span><span class="p">():</span>
            <span class="c1"># TODO: make this an error?</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Format </span><span class="si">{</span><span class="nb">format</span><span class="si">!r}</span><span class="s2"> not listed in back-end input formats&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: Inspect format&#39;s gis_data_type to see if we need to load a VectorCube or classic raster DataCube</span>
        <span class="k">return</span> <span class="n">VectorCube</span><span class="o">.</span><span class="n">load_url</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">create_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Service</span><span class="p">:</span>
        <span class="c1"># TODO: type hint for graph: is it a nested or a flat one?</span>
        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span><span class="n">process_graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preflight_validation</span><span class="p">(</span><span class="n">pg_with_metadata</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/services&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
        <span class="n">service_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OpenEO-Identifier&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Service</span><span class="p">(</span><span class="n">service_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Connection.remove_service">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.remove_service">[docs]</a>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Use :py:meth:`openeo.rest.service.Service.delete_service` instead.&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.8.0&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop and remove a secondary web service.</span>

<span class="sd">        :param service_id: service identifier</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Service</span><span class="p">(</span><span class="n">service_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete_service</span><span class="p">()</span></div>


<div class="viewcode-block" id="Connection.job_results">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.job_results">[docs]</a>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Use :py:meth:`openeo.rest.job.BatchJob.get_results` instead.&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.4.10&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get batch job results metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list_results</span><span class="p">()</span></div>


<div class="viewcode-block" id="Connection.job_logs">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.job_logs">[docs]</a>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Use :py:meth:`openeo.rest.job.BatchJob.logs` instead.&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.4.10&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get batch job logs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.list_files">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.list_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserFile</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists all user-uploaded files in the user workspace on the back-end.</span>

<span class="sd">        :return: List of the user-uploaded files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/files&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserFile</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="n">federation_missing</span> <span class="o">=</span> <span class="n">federation_extension</span><span class="o">.</span><span class="n">get_federation_missing</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
        <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">ext_federation_backend_details</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">VisualList</span><span class="p">(</span>
            <span class="s2">&quot;data-table&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span> <span class="n">federation_missing</span><span class="p">,</span> <span class="s2">&quot;federation&quot;</span><span class="p">:</span> <span class="n">federation</span><span class="p">},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Connection.get_file">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.get_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PurePosixPath</span><span class="p">],</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UserFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a handle to a user-uploaded file in the user workspace on the back-end.</span>

<span class="sd">        :param path: The path on the user workspace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UserFile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.upload_file">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.upload_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upload_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PurePosixPath</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UserFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads a file to the given target location in the user workspace on the back-end.</span>

<span class="sd">        If a file at the target path exists in the user workspace it will be replaced.</span>

<span class="sd">        :param source: A path to a file on the local file system to upload.</span>
<span class="sd">        :param target: The desired path (which can contain a folder structure if desired) on the user workspace.</span>
<span class="sd">            If not set: defaults to the original filename (without any folder structure) of the local file .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># TODO: support other non-path sources too: bytes, open file, url, ...</span>
        <span class="k">with</span> <span class="n">source</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/files/</span><span class="si">{</span><span class="n">target</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserFile</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_build_request_with_process_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">process_graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FlatGraphableMixin</span><span class="p">]],</span>
        <span class="n">additional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a json payload with a process graph to submit to /result, /services, /jobs, ...</span>
<span class="sd">        :param process_graph: flat dict representing a &quot;process graph with metadata&quot; ({&quot;process&quot;: {&quot;process_graph&quot;: ...}, ...})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: make this a more general helper (like `as_flat_graph`)</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="n">extract_connections</span><span class="p">(</span><span class="n">process_graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mixing different connections: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">connections</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">if</span> <span class="n">additional</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">additional</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: this &quot;job_options&quot; top-level property is not in official openEO API spec,</span>
            <span class="c1"># but a commonly used convention, e.g. in openeo-python-driver based deployments.</span>
            <span class="k">assert</span> <span class="s2">&quot;job_options&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;job_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_options</span>

        <span class="n">process_graph</span> <span class="o">=</span> <span class="n">as_flat_graph</span><span class="p">(</span><span class="n">process_graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;process_graph&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">process_graph</span><span class="p">:</span>
            <span class="n">process_graph</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;process_graph&quot;</span><span class="p">:</span> <span class="n">process_graph</span><span class="p">}</span>
        <span class="c1"># TODO: also check if `process_graph` already has &quot;process&quot; key (i.e. is a &quot;process graph with metadata&quot; already)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_graph</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_preflight_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pg_with_metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preflight validation of process graph to execute.</span>

<span class="sd">        :param pg_with_metadata: flat dict representation of process graph with metadata,</span>
<span class="sd">            e.g. as produced by `_build_request_with_process_graph`</span>
<span class="sd">        :param validate: Optional toggle to enable/prevent validation of the process graphs before execution</span>
<span class="sd">            (overruling the connection&#39;s ``auto_validate`` setting).</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_validate</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span><span class="o">.</span><span class="n">supports_endpoint</span><span class="p">(</span><span class="s2">&quot;/validation&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">):</span>
            <span class="c1"># At present, the intention is that a failed validation does not block</span>
            <span class="c1"># the job from running, it is only reported as a warning.</span>
            <span class="c1"># Therefor we also want to continue when something *else* goes wrong</span>
            <span class="c1"># *during* the validation.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/validation&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">],</span> <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                <span class="n">validation_errors</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">validation_errors</span><span class="p">:</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Preflight process graph validation raised: &quot;</span>
                        <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">validation_errors</span><span class="p">))</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preflight process graph validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># TODO: additional validation and sanity checks: e.g. is there a result node, are all process_ids valid, ...?</span>

    <span class="c1"># TODO: unify `download` and `execute` better: e.g. `download` always writes to disk, `execute` returns result (raw or as JSON decoded dict)</span>
<div class="viewcode-block" id="Connection.download">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.download">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FlatGraphableMixin</span><span class="p">]],</span>
        <span class="n">outputfile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_DOWNLOAD_CHUNK_SIZE</span><span class="p">,</span>
        <span class="n">additional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_response_headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResponseHeadersHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the underlying process graph to the backend</span>
<span class="sd">        for synchronous processing and directly download the result.</span>

<span class="sd">        If ``outputfile`` is provided, the result is downloaded to that path.</span>
<span class="sd">        Otherwise a :py:class:`bytes` object is returned with the raw data.</span>

<span class="sd">        :param graph: (flat) dict representing a process graph, or process graph as raw JSON string,</span>
<span class="sd">            or as local file path or URL</span>
<span class="sd">        :param outputfile: (optional) output path to download to.</span>
<span class="sd">        :param timeout: timeout to wait for response</span>
<span class="sd">        :param validate: (optional) toggle to enable/prevent validation of the process graphs before execution</span>
<span class="sd">            (overruling the connection&#39;s ``auto_validate`` setting).</span>
<span class="sd">        :param chunk_size: chunk size for streaming response.</span>
<span class="sd">        :param additional: (optional) additional (top-level) properties to set in the request body</span>
<span class="sd">        :param job_options: (optional) dictionary of job options to pass to the backend</span>
<span class="sd">            (under top-level property &quot;job_options&quot;)</span>
<span class="sd">        :param on_response_headers: (optional) callback to handle (e.g. :py:func:`print`) the response headers.</span>

<span class="sd">        :return: if ``outputfile`` was not specified:</span>
<span class="sd">            a :py:class:`bytes` object containing the raw data.</span>
<span class="sd">            Otherwise, ``None`` is returned.</span>

<span class="sd">        .. versionchanged:: 0.36.0</span>
<span class="sd">            Added arguments ``additional`` and ``job_options``.</span>

<span class="sd">        .. versionchanged:: 0.40</span>
<span class="sd">            Added argument ``on_response_headers``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span>
            <span class="n">process_graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">additional</span><span class="o">=</span><span class="n">additional</span><span class="p">,</span> <span class="n">job_options</span><span class="o">=</span><span class="n">job_options</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preflight_validation</span><span class="p">(</span><span class="n">pg_with_metadata</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/result&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span>
            <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span> <span class="ow">or</span> <span class="n">DEFAULT_TIMEOUT_SYNCHRONOUS_EXECUTE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">on_response_headers</span> <span class="o">:=</span> <span class="p">(</span><span class="n">on_response_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_response_headers_sync</span><span class="p">):</span>
            <span class="n">on_response_headers</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outputfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">outputfile</span><span class="p">)</span>
            <span class="n">ensure_dir</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">target</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="c1"># TODO: return target path instead of None? Or return a generic result wrapper?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span></div>


<div class="viewcode-block" id="Connection.execute">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">process_graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FlatGraphableMixin</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auto_decode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">additional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_response_headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResponseHeadersHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a process graph synchronously and return the result. If the result is a JSON object, it will be parsed.</span>

<span class="sd">        :param process_graph: (flat) dict representing a process graph, or process graph as raw JSON string,</span>
<span class="sd">            or as local file path or URL</span>
<span class="sd">        :param validate: Optional toggle to enable/prevent validation of the process graphs before execution</span>
<span class="sd">            (overruling the connection&#39;s ``auto_validate`` setting).</span>
<span class="sd">        :param auto_decode: Boolean flag to enable/disable automatic JSON decoding of the response. Defaults to True.</span>
<span class="sd">        :param additional: additional (top-level) properties to set in the request body</span>
<span class="sd">        :param job_options: dictionary of job options to pass to the backend</span>
<span class="sd">            (under top-level property &quot;job_options&quot;)</span>
<span class="sd">        :param on_response_headers: (optional) callback to handle (e.g. :py:func:`print`) the response headers.</span>

<span class="sd">        :return: parsed JSON response as a dict if auto_decode is True, otherwise response object</span>

<span class="sd">        .. versionadded:: 0.36.0</span>
<span class="sd">            Added arguments ``additional`` and ``job_options``.</span>

<span class="sd">        .. versionchanged:: 0.48</span>
<span class="sd">            Added argument ``on_response_headers``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span>
            <span class="n">process_graph</span><span class="o">=</span><span class="n">process_graph</span><span class="p">,</span> <span class="n">additional</span><span class="o">=</span><span class="n">additional</span><span class="p">,</span> <span class="n">job_options</span><span class="o">=</span><span class="n">job_options</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preflight_validation</span><span class="p">(</span><span class="n">pg_with_metadata</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/result&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span>
            <span class="n">expected_status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span> <span class="ow">or</span> <span class="n">DEFAULT_TIMEOUT_SYNCHRONOUS_EXECUTE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">on_response_headers</span> <span class="o">:=</span> <span class="p">(</span><span class="n">on_response_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_response_headers_sync</span><span class="p">):</span>
            <span class="n">on_response_headers</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auto_decode</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to decode response as JSON. For other data types use `download` method instead of `execute`.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="Connection.create_job">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.create_job">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">process_graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FlatGraphableMixin</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plan</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">budget</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">additional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BatchJob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the underlying process graph to the backend</span>
<span class="sd">        to create an openEO batch job</span>
<span class="sd">        and return a corresponding :py:class:`~openeo.rest.job.BatchJob` instance.</span>

<span class="sd">        Note that this method only *creates* the openEO batch job at the backend,</span>
<span class="sd">        but it does not *start* it.</span>
<span class="sd">        Use :py:meth:`execute_batch` instead to let the openEO Python client</span>
<span class="sd">        take care of the full job life cycle: create, start and track its progress until completion.</span>

<span class="sd">        :param process_graph: openEO-style (flat) process graph representation,</span>
<span class="sd">            or an object that can be converted to such a representation:</span>
<span class="sd">            a dictionary, a :py:class:`~openeo.rest.datacube.DataCube` object,</span>
<span class="sd">            a string with a JSON representation,</span>
<span class="sd">            a local file path or URL to a JSON representation,</span>
<span class="sd">            a :py:class:`~openeo.rest.multiresult.MultiResult` object, ...</span>
<span class="sd">        :param title: (optional) job title.</span>
<span class="sd">        :param description: (optional) job description.</span>
<span class="sd">        :param plan: (optional) the billing plan to process and charge the job with.</span>
<span class="sd">        :param budget: (optional) maximum budget to be spent on executing the job.</span>
<span class="sd">            Note that some backends do not honor this limit.</span>
<span class="sd">        :param additional: (optional) additional (top-level) properties to set in the request body</span>
<span class="sd">        :param job_options: (optional) dictionary of job options to pass to the backend</span>
<span class="sd">            (under top-level property &quot;job_options&quot;)</span>
<span class="sd">        :param validate: (optional) toggle to enable/prevent validation of the process graphs before execution</span>
<span class="sd">            (overruling the connection&#39;s ``auto_validate`` setting).</span>
<span class="sd">        :param log_level: (optional) minimum severity level for log entries that the back-end should keep track of.</span>
<span class="sd">            One of &quot;error&quot; (highest severity), &quot;warning&quot;, &quot;info&quot;, and &quot;debug&quot; (lowest severity).</span>

<span class="sd">        :return: Handle to the job created at the backend.</span>

<span class="sd">        .. versionchanged:: 0.35.0</span>
<span class="sd">            Add :ref:`multi-result support &lt;multi-result-process-graphs&gt;`.</span>

<span class="sd">        .. versionchanged:: 0.36.0</span>
<span class="sd">            Added argument ``job_options``.</span>

<span class="sd">        .. versionchanged:: 0.37.0</span>
<span class="sd">            Added argument ``log_level``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO move all this (BatchJob factory) logic to BatchJob?</span>

        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span>
            <span class="n">process_graph</span><span class="o">=</span><span class="n">process_graph</span><span class="p">,</span>
            <span class="n">additional</span><span class="o">=</span><span class="n">additional</span><span class="p">,</span>
            <span class="n">job_options</span><span class="o">=</span><span class="n">job_options</span><span class="p">,</span>
            <span class="o">**</span><span class="n">dict_no_none</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span> <span class="n">budget</span><span class="o">=</span><span class="n">budget</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">log_level</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_preflight_validation</span><span class="p">(</span><span class="n">pg_with_metadata</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/jobs&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">expected_status</span><span class="o">=</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;openeo-identifier&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;openeo-identifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s2">&quot;location&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Backend did not explicitly respond with job id, will guess it from redirect URL.&quot;</span><span class="p">)</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;Job creation response did not contain a valid job id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.job">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.job">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BatchJob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the job based on the id. The job with the given id should already exist.</span>

<span class="sd">        Use :py:meth:`openeo.rest.connection.Connection.create_job` to create new jobs</span>

<span class="sd">        :param job_id: the job id of an existing job</span>
<span class="sd">        :return: A job object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.service">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.service">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Service</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the secondary web service based on the id. The service with the given id should already exist.</span>

<span class="sd">        Use :py:meth:`openeo.rest.connection.Connection.create_service` to create new services</span>

<span class="sd">        :param job_id: the service id of an existing secondary web service</span>
<span class="sd">        :return: A service object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Service</span><span class="p">(</span><span class="n">service_id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.as_curl">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.as_curl">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_curl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">DataCube</span><span class="p">,</span> <span class="n">FlatGraphableMixin</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/result&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="n">obfuscate_auth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">additional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build curl command to evaluate given process graph or data cube</span>
<span class="sd">        (including authorization and content-type headers).</span>

<span class="sd">            &gt;&gt;&gt; print(connection.as_curl(cube))</span>
<span class="sd">            curl -i -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer ...&#39; \\</span>
<span class="sd">                --data &#39;{&quot;process&quot;:{&quot;process_graph&quot;:{...}}&#39; \\</span>
<span class="sd">                https://openeo.example/openeo/1.1/result</span>

<span class="sd">        :param data: something that is convertable to an openEO process graph: a dictionary,</span>
<span class="sd">            a :py:class:`~openeo.rest.datacube.DataCube` object,</span>
<span class="sd">            a :py:class:`~openeo.processes.ProcessBuilder`, ...</span>
<span class="sd">        :param path: endpoint to send request to: typically ``&quot;/result&quot;`` (default) for synchronous requests</span>
<span class="sd">            or ``&quot;/jobs&quot;`` for batch jobs</span>
<span class="sd">        :param method: HTTP method to use (typically ``&quot;POST&quot;``)</span>
<span class="sd">        :param obfuscate_auth: don&#39;t show actual bearer token</span>
<span class="sd">        :param additional: additional (top-level) properties to set in the request body</span>
<span class="sd">        :param job_options: dictionary of job options to pass to the backend</span>
<span class="sd">            (under top-level property &quot;job_options&quot;)</span>

<span class="sd">        :return: curl command as a string</span>

<span class="sd">        .. versionadded:: 0.36.0</span>
<span class="sd">            Added arguments ``additional`` and ``job_options``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;curl&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;-X&quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">]</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-H&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth</span><span class="p">,</span> <span class="n">BearerAuth</span><span class="p">):</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-H&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Authorization: Bearer </span><span class="si">{</span><span class="s1">&#39;...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">obfuscate_auth</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">bearer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request_with_process_graph</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">additional</span><span class="o">=</span><span class="n">additional</span><span class="p">,</span> <span class="n">job_options</span><span class="o">=</span><span class="n">job_options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;/validation&quot;</span><span class="p">:</span>
            <span class="n">pg_with_metadata</span> <span class="o">=</span> <span class="n">pg_with_metadata</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span>
        <span class="n">post_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pg_with_metadata</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">))</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;--data&quot;</span><span class="p">,</span> <span class="n">post_json</span><span class="p">]</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">build_url</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">)</span></div>


<div class="viewcode-block" id="Connection.version_info">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.version_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">version_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List version of the openEO client, API, back-end, etc.&quot;&quot;&quot;</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="n">openeo</span><span class="o">.</span><span class="n">client_version</span><span class="p">(),</span>
            <span class="s2">&quot;api&quot;</span><span class="p">:</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">api_version</span><span class="p">(),</span>
            <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="n">dict_no_none</span><span class="p">({</span>
                <span class="s2">&quot;root_url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_url</span><span class="p">,</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend_version&quot;</span><span class="p">),</span>
                <span class="s2">&quot;processing:software&quot;</span><span class="p">:</span> <span class="n">capabilities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;processing:software&quot;</span><span class="p">),</span>
            <span class="p">}),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="Connection.web_editor">
<a class="viewcode-back" href="../../../api.html#openeo.Connection.web_editor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">web_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">editor_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://editor.openeo.org/&quot;</span><span class="p">,</span> <span class="n">anonymous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate URL to open this backend in the openEO Web Editor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add option to directly open link with `webbrowser.open()`?</span>
        <span class="c1"># TODO: add option to print (or jupyter-aware display) the link instead of returning it?</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_url</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">anonymous</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;discover&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">editor_url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">url</span></div>
</div>



<div class="viewcode-block" id="connect">
<a class="viewcode-back" href="../../../api.html#openeo.connect">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">auth_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">auth_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">retry</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">urllib3</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Retry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_response_headers_sync</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResponseHeadersHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is the entry point to OpenEO.</span>
<span class="sd">    You typically create one connection object in your script or application</span>
<span class="sd">    and re-use it for all calls to that backend.</span>

<span class="sd">    If the backend requires authentication, you can pass authentication data directly to this function,</span>
<span class="sd">    but it could be easier to authenticate as follows:</span>

<span class="sd">        &gt;&gt;&gt; # For basic authentication</span>
<span class="sd">        &gt;&gt;&gt; conn = connect(url).authenticate_basic(username=&quot;john&quot;, password=&quot;foo&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # For OpenID Connect authentication</span>
<span class="sd">        &gt;&gt;&gt; conn = connect(url).authenticate_oidc(client_id=&quot;myclient&quot;)</span>

<span class="sd">    :param url: The http url of the OpenEO back-end.</span>
<span class="sd">    :param auth_type: Which authentication to use: None, &quot;basic&quot; or &quot;oidc&quot; (for OpenID Connect)</span>
<span class="sd">    :param auth_options: Options/arguments specific to the authentication type</span>
<span class="sd">    :param default_timeout: default timeout (in seconds) for requests</span>
<span class="sd">    :param auto_validate: toggle to automatically validate process graphs before execution</span>
<span class="sd">    :param retry: general request retry settings, can be specified as:</span>

<span class="sd">        - :py:class:`urllib3.util.Retry` object</span>
<span class="sd">          or a dictionary with corresponding keyword arguments</span>
<span class="sd">          (e.g. ``total``, ``backoff_factor``, ``status_forcelist``, ...)</span>
<span class="sd">        - ``None`` (default) to use default openEO-oriented retry settings</span>
<span class="sd">        - ``False`` to disable retrying requests</span>

<span class="sd">    :param on_response_headers_sync: (optional) callback to handle (e.g. :py:func:`print`)</span>
<span class="sd">        the response headers of synchronous processing requests.</span>

<span class="sd">    .. versionchanged:: 0.24.0</span>
<span class="sd">        Added ``auto_validate`` argument</span>

<span class="sd">    .. versionchanged:: 0.41.0</span>
<span class="sd">        Added ``retry`` argument.</span>

<span class="sd">    .. versionchanged:: 0.48</span>
<span class="sd">        Added argument ``on_response_headers_sync``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_config_log</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">config_log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">default_backend</span> <span class="o">=</span> <span class="n">get_config_option</span><span class="p">(</span><span class="s2">&quot;connection.default_backend&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_backend</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">default_backend</span>
            <span class="n">_config_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using default back-end URL </span><span class="si">{</span><span class="n">url</span><span class="si">!r}</span><span class="s2"> (from config)&quot;</span><span class="p">)</span>
            <span class="n">default_backend_auto_auth</span> <span class="o">=</span> <span class="n">get_config_option</span><span class="p">(</span><span class="s2">&quot;connection.default_backend.auto_authenticate&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_backend_auto_auth</span> <span class="ow">and</span> <span class="n">default_backend_auto_auth</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span> <span class="s2">&quot;oidc&quot;</span><span class="p">}:</span>
                <span class="n">auth_type</span> <span class="o">=</span> <span class="n">default_backend_auto_auth</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">_config_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Doing auto-authentication </span><span class="si">{</span><span class="n">auth_type</span><span class="si">!r}</span><span class="s2"> (from config)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">auth_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auto_authenticate</span> <span class="o">=</span> <span class="n">get_config_option</span><span class="p">(</span><span class="s2">&quot;connection.auto_authenticate&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auto_authenticate</span> <span class="ow">and</span> <span class="n">auto_authenticate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span> <span class="s2">&quot;oidc&quot;</span><span class="p">}:</span>
            <span class="n">auth_type</span> <span class="o">=</span> <span class="n">auto_authenticate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">_config_log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Doing auto-authentication </span><span class="si">{</span><span class="n">auth_type</span><span class="si">!r}</span><span class="s2"> (from config)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OpenEoClientException</span><span class="p">(</span><span class="s2">&quot;No openEO back-end URL given or known to connect to.&quot;</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
        <span class="n">default_timeout</span><span class="o">=</span><span class="n">default_timeout</span><span class="p">,</span>
        <span class="n">auto_validate</span><span class="o">=</span><span class="n">auto_validate</span><span class="p">,</span>
        <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">,</span>
        <span class="n">on_response_headers_sync</span><span class="o">=</span><span class="n">on_response_headers_sync</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">auth_type</span> <span class="o">=</span> <span class="n">auth_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">auth_type</span>
    <span class="k">if</span> <span class="n">auth_type</span> <span class="ow">in</span> <span class="p">{</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">}:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">auth_type</span> <span class="o">==</span> <span class="s2">&quot;basic&quot;</span><span class="p">:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">authenticate_basic</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">auth_options</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">elif</span> <span class="n">auth_type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;oidc&quot;</span><span class="p">,</span> <span class="s2">&quot;openid&quot;</span><span class="p">}:</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">authenticate_oidc</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">auth_options</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown auth type </span><span class="si">{a!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">auth_type</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">connection</span></div>



<span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Use :py:func:`openeo.connect` instead&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.0.9&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">session</span><span class="p">(</span><span class="n">userid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://openeo.org/openeo&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Connection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is the entry point to OpenEO. You typically create one session object in your script or application, per back-end.</span>
<span class="sd">    and re-use it for all calls to that backend.</span>
<span class="sd">    If the backend requires authentication, you should set pass your credentials.</span>

<span class="sd">    :param endpoint: The http url of an OpenEO endpoint.</span>
<span class="sd">    :rtype: openeo.sessions.Session</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">endpoint</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">paginate</span><span class="p">(</span><span class="n">con</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">resp</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="n">resp</span><span class="p">):</span>
    <span class="c1"># TODO: make this a method `get_paginated` on `RestApiConnection`?</span>
    <span class="c1"># TODO: is it necessary to have `callback`? It&#39;s only used just before yielding,</span>
    <span class="c1">#       so it&#39;s probably cleaner (even for the caller) to to move it outside.</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
        <span class="n">next_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;next&quot;</span> <span class="ow">and</span> <span class="s2">&quot;href&quot;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_links</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">next_links</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">extract_connections</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_ProcessGraphAbstraction</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">_ProcessGraphAbstraction</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Connection</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the :py:class:`Connection` object(s) linked from a given data construct.</span>
<span class="sd">    Typical use case is to get the connection from a :py:class:`DataCube`,</span>
<span class="sd">    but can also extract multiple connections from a list of data cubes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># TODO: define some kind of &quot;Connected&quot; interface/mixin/protocol</span>
    <span class="c1">#       for objects that contain a connection instead of just checking for _ProcessGraphAbstraction</span>
    <span class="c1"># TODO: also support extracting connections from other objects like BatchJob, ...</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_ProcessGraphAbstraction</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">connection</span><span class="p">:</span>
        <span class="n">connections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">connection</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">_ProcessGraphAbstraction</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">connection</span><span class="p">:</span>
                <span class="n">connections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">connection</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">connections</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">openEO Python Client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Open-EO&repo=openeo-python-client&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">openEO Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_access.html">Finding and loading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processes.html">Working with processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../batch_jobs.html">Batch Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../udp.html">User-Defined Processes (UDP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auth.html">Authentication and Account Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../udf.html">User-Defined Functions (UDF) explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datacube_construction.html">DataCube construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../machine_learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbook/index.html">openEO CookBook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API (General)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-processes.html">API: <code class="docutils literal notranslate"><span class="pre">openeo.processes</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-artifacts.html">API: openeo.extra.artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process_mapping.html">openEO Process Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../best_practices.html">Best practices, coding style and general tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../federation-extension.html">Federation extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- Alabaster (krTheme++) Hacks -->

<div class="sidebar-meta">
<h3>Meta</h3>
<div>Docs for openEO Python Client</div>
<div>Version: <code>0.49.0a1</code></div>
<div>Last updated: 2026/02/17</div>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017 - 2026, Jeroen Dries.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>