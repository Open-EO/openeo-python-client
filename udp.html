<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>User-Defined Processes (UDP) &#8212; openEO Python Client 0.49.0a1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=ad3dbffd" />
    <script src="_static/documentation_options.js?v=6f1c2e36"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication and Account Management" href="auth.html" />
    <link rel="prev" title="Batch Jobs" href="batch_jobs.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="user-defined-processes-udp">
<span id="user-defined-processes"></span><h1>User-Defined Processes (UDP)<a class="headerlink" href="#user-defined-processes-udp" title="Link to this heading">¶</a></h1>
<section id="code-reuse-with-user-defined-processes">
<h2>Code reuse with user-defined processes<a class="headerlink" href="#code-reuse-with-user-defined-processes" title="Link to this heading">¶</a></h2>
<p>As explained before, processes can be chained together in a process graph
to build a certain algorithm.
Often, you have certain (sub)chains that reoccur in the same process graph
of even in different process graphs or algorithms.</p>
<p>The openEO API enables you to store such (sub)chains
on the back-end as a so called <strong>user-defined process</strong>.
This allows you to build your own <em>library of reusable building blocks</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not confuse <strong>user-defined processes</strong> (sometimes abbreviated as UDP) with
<strong>user-defined functions</strong> (UDF) in openEO, which is a mechanism to
inject Python or R scripts as process nodes in a process graph.
See <a class="reference internal" href="udf.html#user-defined-functions"><span class="std std-ref">User-Defined Functions (UDF) explained</span></a> for more information.</p>
</div>
<p>A user-defined process can not only be constructed from
pre-defined processes provided by the back-end,
but also other user-defined processes.</p>
<p>Ultimately, the openEO API allows you to publicly expose your user-defined process,
so that other users can invoke it as a service.
This turns your openEO process into a web application
that can be executed using the regular openEO
support for synchronous and asynchronous jobs.</p>
</section>
<section id="process-parameters">
<h2>Process Parameters<a class="headerlink" href="#process-parameters" title="Link to this heading">¶</a></h2>
<p>User-defined processes are usually <strong>parameterized</strong>,
meaning certain inputs are expected when calling the process.</p>
<p>For example, if you often have to convert Fahrenheit to Celsius:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>
</pre></div>
</div>
<p>you could define a user-defined process <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code>,
consisting of two simple mathematical operations
(pre-defined processes <code class="docutils literal notranslate"><span class="pre">subtract</span></code> and <code class="docutils literal notranslate"><span class="pre">divide</span></code>).</p>
<p>We can represent this in openEO’s JSON based format as follows
(don’t worry too much about the syntax details of this representation,
the openEO Python client will hide this usually):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;subtract32&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;process_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;from_parameter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;divide18&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;process_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;divide&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;from_node&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subtract32&quot;</span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.8</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The important point here is the parameter reference <code class="docutils literal notranslate"><span class="pre">{&quot;from_parameter&quot;:</span> <span class="pre">&quot;fahrenheit&quot;}</span></code> in the subtraction.
When we call this user-defined process we will have to provide a Fahrenheit value.
For example with 70 degrees Fahrenheit (again in openEO JSON format here):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;process_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;fahrenheit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">70</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="declaring-parameters">
<span id="udp-declaring-parameters"></span><h3>Declaring Parameters<a class="headerlink" href="#declaring-parameters" title="Link to this heading">¶</a></h3>
<p>It’s good style to declare what parameters your user-defined process expects and supports.
It allows you to document your parameters, define the data type(s) you expect
(the “schema” in openEO-speak) and define default values.</p>
<p>The openEO Python client lets you define parameters as
<a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> instances.
In general you have to specify at least the parameter name,
a description and a schema (to declare the expected parameter type).
The “fahrenheit” parameter from the example above can be defined like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">openeo.api.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>

<span class="n">fahrenheit_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To simplify working with parameter schemas, the <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> class
provides a couple of helpers to create common types of parameters.
In the example above, the “fahrenheit” parameter (a number) can also be created more compactly
with the <a class="reference internal" href="api.html#openeo.api.process.Parameter.number" title="openeo.api.process.Parameter.number"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.number()</span></code></a> helper:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fahrenheit_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Some useful parameter helpers (class methods of the <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> class):</p>
<ul class="simple">
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.string" title="openeo.api.process.Parameter.string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.string()</span></code></a>
to create a string parameter,
e.g. to parameterize the collection id in a <code class="docutils literal notranslate"><span class="pre">load_collection</span></code> call in your UDP.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.integer" title="openeo.api.process.Parameter.integer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.integer()</span></code></a>,
<a class="reference internal" href="api.html#openeo.api.process.Parameter.number" title="openeo.api.process.Parameter.number"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.number()</span></code></a>,
and <a class="reference internal" href="api.html#openeo.api.process.Parameter.boolean" title="openeo.api.process.Parameter.boolean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.boolean()</span></code></a>
to create integer, floating point, or boolean parameters respectively.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.array" title="openeo.api.process.Parameter.array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.array()</span></code></a>
to create an array parameter,
e.g. to parameterize the a band selection  in a <code class="docutils literal notranslate"><span class="pre">load_collection</span></code> call in your UDP.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.datacube" title="openeo.api.process.Parameter.datacube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.datacube()</span></code></a>
(or its legacy, deprecated cousin <a class="reference internal" href="api.html#openeo.api.process.Parameter.raster_cube" title="openeo.api.process.Parameter.raster_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.raster_cube()</span></code></a>)
to create a data cube parameter.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.bounding_box" title="openeo.api.process.Parameter.bounding_box"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.bounding_box()</span></code></a> to create
a parameter for specifying a spatial extent with “west”, “south”, “east”, “north” bounds.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.date" title="openeo.api.process.Parameter.date"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.date()</span></code></a> and
<a class="reference internal" href="api.html#openeo.api.process.Parameter.date_time" title="openeo.api.process.Parameter.date_time"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.date_time()</span></code></a>
to create date or date+time parameters.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.temporal_interval" title="openeo.api.process.Parameter.temporal_interval"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.temporal_interval()</span></code></a> to create
a parameter for specifying a temporal interval with “start” and “end” dates.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.geojson" title="openeo.api.process.Parameter.geojson"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.geojson()</span></code></a> to create
a parameter for specifying a GeoJSON geometry.</p></li>
<li><p><a class="reference internal" href="api.html#openeo.api.process.Parameter.spatial_extent" title="openeo.api.process.Parameter.spatial_extent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Parameter.spatial_extent()</span></code></a> to create
a spatial_extent parameter that is exactly the same as the corresponding parameter in <code class="docutils literal notranslate"><span class="pre">load_collection</span></code> and <code class="docutils literal notranslate"><span class="pre">load_stac</span></code>.</p></li>
</ul>
<p>Consult the documentation of these helper class methods for additional features.
For example, declaring a default value for an integer parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">size_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Kernel size&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="more-advanced-parameter-schemas">
<h3>More advanced parameter schemas<a class="headerlink" href="#more-advanced-parameter-schemas" title="Link to this heading">¶</a></h3>
<p>While the helper class methods of <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> (discussed above)
cover the most common parameter usage,
you also might need to declare some parameters with a more special or specific schema.
You can do that through the <code class="docutils literal notranslate"><span class="pre">schema</span></code> argument
of the basic <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter()</span></code></a> constructor.
This “schema” argument follows the <a class="reference external" href="https://json-schema.org/">JSON Schema draft-07</a> specification,
which we will briefly illustrate here.</p>
<p>Basic primitives can be declared through a (required) “type” field, for example:
<code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;string&quot;}</span></code> for strings, <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;integer&quot;}</span></code> for integers, etc.</p>
<p>Likewise, arrays can be defined with a minimal <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;array&quot;}</span></code>.
In addition, the expected type of the array items can also be specified,
e.g. an array of integers:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Another, more complex type is <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;object&quot;}</span></code> for parameters
that are like Python dictionaries (or mappings).
For example, to define a bounding box parameter
that should contain certain fields with certain type:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;west&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;south&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;east&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;north&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;crs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Check the documentation and examples of <a class="reference external" href="https://json-schema.org/">JSON Schema draft-07</a>
for even more features.</p>
<p>On top of these generic types, the openEO API also defines a couple of custom (sub)types
in the <a class="reference external" href="https://github.com/Open-EO/openeo-processes">openeo-processes project</a>
(see the <code class="docutils literal notranslate"><span class="pre">meta/subtype-schemas.json</span></code> listing).
For example, the schema of an openEO data cube is:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;subtype&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;datacube&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="building-and-storing-user-defined-process">
<span id="build-and-store-udp"></span><h2>Building and storing user-defined process<a class="headerlink" href="#building-and-storing-user-defined-process" title="Link to this heading">¶</a></h2>
<p>There are a couple of ways to build and store user-defined processes:</p>
<ul class="simple">
<li><p>using predefined <a class="reference internal" href="#create-udp-through-process-functions"><span class="std std-ref">process functions</span></a></p></li>
<li><p><a class="reference internal" href="#create-udp-parameterized-cube"><span class="std std-ref">parameterized building of a data cube</span></a></p></li>
<li><p><a class="reference internal" href="#create-udp-from-dict"><span class="std std-ref">directly from a well-formatted dictionary</span></a> process graph representation</p></li>
</ul>
<section id="through-process-functions">
<span id="create-udp-through-process-functions"></span><h3>Through “process functions”<a class="headerlink" href="#through-process-functions" title="Link to this heading">¶</a></h3>
<p>The openEO Python Client Library defines the
official processes in the <a class="reference internal" href="api-processes.html#module-openeo.processes" title="openeo.processes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">openeo.processes</span></code></a> module,
which can be used to build a process graph as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">openeo.processes</span><span class="w"> </span><span class="kn">import</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">divide</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.api.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>

<span class="c1"># Define the input parameter.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit.&quot;</span><span class="p">)</span>

<span class="c1"># Do the calculations, using the parameter and other values</span>
<span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="n">divide</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">32</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>

<span class="c1"># Store user-defined process in openEO back-end.</span>
<span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code> object encapsulates the subtract and divide calculations in a symbolic way.
We can pass it directly to <a class="reference internal" href="api.html#openeo.rest.connection.Connection.save_user_defined_process" title="openeo.rest.connection.Connection.save_user_defined_process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_user_defined_process()</span></code></a>.</p>
<p>If you want to inspect its openEO-style process graph representation,
use the <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube.to_json" title="openeo.rest.datacube.DataCube.to_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_json()</span></code></a>
or <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube.print_json" title="openeo.rest.datacube.DataCube.print_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">print_json()</span></code></a> method:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fahrenheit_to_celsius</span><span class="o">.</span><span class="n">print_json</span><span class="p">()</span>
<span class="go">{</span>
<span class="go">  &quot;process_graph&quot;: {</span>
<span class="go">    &quot;subtract1&quot;: {</span>
<span class="go">      &quot;process_id&quot;: &quot;subtract&quot;,</span>
<span class="go">      &quot;arguments&quot;: {</span>
<span class="go">        &quot;x&quot;: {</span>
<span class="go">          &quot;from_parameter&quot;: &quot;f&quot;</span>
<span class="go">        },</span>
<span class="go">        &quot;y&quot;: 32</span>
<span class="go">      }</span>
<span class="go">    },</span>
<span class="go">    &quot;divide1&quot;: {</span>
<span class="go">      &quot;process_id&quot;: &quot;divide&quot;,</span>
<span class="go">      &quot;arguments&quot;: {</span>
<span class="go">        &quot;x&quot;: {</span>
<span class="go">          &quot;from_node&quot;: &quot;subtract1&quot;</span>
<span class="go">        },</span>
<span class="go">        &quot;y&quot;: 1.8</span>
<span class="go">      },</span>
<span class="go">      &quot;result&quot;: true</span>
<span class="go">    }</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
</section>
<section id="from-a-parameterized-data-cube">
<span id="create-udp-parameterized-cube"></span><h3>From a parameterized data cube<a class="headerlink" href="#from-a-parameterized-data-cube" title="Link to this heading">¶</a></h3>
<p>It’s also possible to work with a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> directly
and parameterize it.
Let’s create, as a simple but functional example, a custom <code class="docutils literal notranslate"><span class="pre">load_collection</span></code>
with hardcoded collection id and band name
and a parameterized spatial extent (with default):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_extent</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="mf">3.7</span><span class="p">,</span> <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="mf">51.03</span><span class="p">,</span> <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="mf">51.05</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="s2">&quot;SENTINEL2_L2A_SENTINELHUB&quot;</span><span class="p">,</span>
    <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;B04&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note how we just can pass <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> objects as arguments
while building a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not all <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> methods/processes properly support
<a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> arguments.
Please submit a bug report when you encounter missing or wrong parameterization support.</p>
</div>
<p>We can now store this as a user-defined process called “fancy_load_collection” on the back-end:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="s2">&quot;fancy_load_collection&quot;</span><span class="p">,</span>
    <span class="n">cube</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">spatial_extent</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you want to inspect its openEO-style process graph representation,
use the <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube.to_json" title="openeo.rest.datacube.DataCube.to_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_json()</span></code></a>
or <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube.print_json" title="openeo.rest.datacube.DataCube.print_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">print_json()</span></code></a> method:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span><span class="o">.</span><span class="n">print_json</span><span class="p">()</span>
<span class="go">{</span>
<span class="go">  &quot;loadcollection1&quot;: {</span>
<span class="go">    &quot;process_id&quot;: &quot;load_collection&quot;,</span>
<span class="go">    &quot;arguments&quot;: {</span>
<span class="go">      &quot;id&quot;: &quot;SENTINEL2_L2A_SENTINELHUB&quot;,</span>
<span class="go">      &quot;bands&quot;: [</span>
<span class="go">        &quot;B04&quot;</span>
<span class="go">      ],</span>
<span class="go">      &quot;spatial_extent&quot;: {</span>
<span class="go">        &quot;from_parameter&quot;: &quot;bbox&quot;</span>
<span class="go">      },</span>
<span class="go">      &quot;temporal_extent&quot;: null</span>
<span class="go">    },</span>
<span class="go">    &quot;result&quot;: true</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
</section>
<section id="using-a-predefined-dictionary">
<span id="create-udp-from-dict"></span><h3>Using a predefined dictionary<a class="headerlink" href="#using-a-predefined-dictionary" title="Link to this heading">¶</a></h3>
<p>In some (advanced) situation, you might already have
the process graph in dictionary format
(or JSON format, which is very close and easy to transform).
Another developer already prepared it for you,
or you prefer to fine-tune process graphs in a JSON editor.
It is very straightforward to submit this as a user-defined process.</p>
<p>Say we start from the following Python dictionary,
representing the Fahrenheit to Celsius conversion we discussed before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;subtract1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;divide1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;divide&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_node&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract1&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">},</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}}</span>
</pre></div>
</div>
<p>We can store this directly, taking into account that we have to define
a parameter named <code class="docutils literal notranslate"><span class="pre">f</span></code> corresponding with the <code class="docutils literal notranslate"><span class="pre">{&quot;from_parameter&quot;:</span> <span class="pre">&quot;f&quot;}</span></code> argument
from the dictionary above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="n">user_defined_process_id</span><span class="o">=</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">process_graph</span><span class="o">=</span><span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span><span class="p">)]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="store-to-a-file">
<h3>Store to a file<a class="headerlink" href="#store-to-a-file" title="Link to this heading">¶</a></h3>
<p>Some use cases might require storing the user-defined process in,
for example, a JSON file instead of storing it directly on a back-end.
Use <a class="reference internal" href="api.html#openeo.rest.udp.build_process_dict" title="openeo.rest.udp.build_process_dict"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_process_dict()</span></code></a> to build a dictionary
compatible with the “process graph with metadata” format of the openEO API
and dump it in JSON format to a file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.rest.udp</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_process_dict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.processes</span><span class="w"> </span><span class="kn">import</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">divide</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.api.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>

<span class="n">fahrenheit</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit.&quot;</span><span class="p">)</span>
<span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="n">divide</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fahrenheit</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">32</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>

<span class="n">spec</span> <span class="o">=</span> <span class="n">build_process_dict</span><span class="p">(</span>
    <span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">process_graph</span><span class="o">=</span><span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">fahrenheit</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fahrenheit_to_celsius.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This results in a JSON file like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;process_graph&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;subtract1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;process_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="err">...</span>
<span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;f&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="err">...</span>
</pre></div>
</div>
</section>
</section>
<section id="evaluate-user-defined-processes">
<span id="evaluate-udp"></span><h2>Evaluate user-defined processes<a class="headerlink" href="#evaluate-user-defined-processes" title="Link to this heading">¶</a></h2>
<p>Let’s evaluate the user-defined processes we defined.</p>
<p>Because there is no pre-defined
wrapper function for our user-defined process, we use the
generic <a class="reference internal" href="api.html#openeo.processes.process" title="openeo.processes.process"><code class="xref py py-func docutils literal notranslate"><span class="pre">openeo.processes.process()</span></code></a> function to build a simple
process graph that calls our <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code> process:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pg</span> <span class="o">=</span> <span class="n">openeo</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pg</span><span class="o">.</span><span class="n">print_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">{&quot;process_graph&quot;: {&quot;fahrenheittocelsius1&quot;: {&quot;process_id&quot;: &quot;fahrenheit_to_celsius&quot;, &quot;arguments&quot;: {&quot;f&quot;: 70}, &quot;result&quot;: true}}}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="go">21.11111111111111</span>
</pre></div>
</div>
<p>To use our custom <code class="docutils literal notranslate"><span class="pre">fancy_load_collection</span></code> process,
we only have to specify a temporal extent,
and let the predefined and default values do their work.
We will use <a class="reference internal" href="api.html#openeo.rest.connection.Connection.datacube_from_process" title="openeo.rest.connection.Connection.datacube_from_process"><code class="xref py py-func docutils literal notranslate"><span class="pre">datacube_from_process()</span></code></a>
to construct a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> object
which we can process further and download:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">datacube_from_process</span><span class="p">(</span><span class="s2">&quot;fancy_load_collection&quot;</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">filter_temporal</span><span class="p">(</span><span class="s2">&quot;2020-09-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-09-10&quot;</span><span class="p">)</span>
<span class="n">cube</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;fancy.tiff&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="datacube_construction.html#datacube-from-process"><span class="std std-ref">Construct DataCube from process</span></a> for more information on <a class="reference internal" href="api.html#openeo.rest.connection.Connection.datacube_from_process" title="openeo.rest.connection.Connection.datacube_from_process"><code class="xref py py-func docutils literal notranslate"><span class="pre">datacube_from_process()</span></code></a>.</p>
</section>
<section id="udp-example-evi-timeseries">
<span id="udp-example-evi"></span><h2>UDP Example: EVI timeseries<a class="headerlink" href="#udp-example-evi-timeseries" title="Link to this heading">¶</a></h2>
<p>In this UDP example, we’ll build a reusable UDP <code class="docutils literal notranslate"><span class="pre">evi_timeseries</span></code>
to calculate the EVI timeseries for a given geometry.
It’s a simplified version of the EVI workflow laid out in <a class="reference internal" href="basics.html#basic-example-evi-map-and-timeseries"><span class="std std-ref">Example use case: EVI map and timeseries</span></a>,
focussing on the UDP-specific aspects: defining and using parameters;
building, storing, and finally executing the UDP.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openeo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openeo.api.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>

<span class="c1"># Create connection to openEO back-end</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">openeo</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">authenticate_oidc</span><span class="p">()</span>

<span class="c1"># Declare the UDP parameters</span>
<span class="n">temporal_extent</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temporal_extent&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The date range to calculate the EVI for.&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;temporal-interval&quot;</span><span class="p">},</span>
    <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;2018-06-15&quot;</span><span class="p">,</span> <span class="s2">&quot;2018-06-27&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The geometry (a single (multi)polygon or a feature collection of (multi)polygons) of to calculate the EVI for.&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;geojson&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Load raw SENTINEL2_L2A data</span>
<span class="n">sentinel2_cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="s2">&quot;SENTINEL2_L2A&quot;</span><span class="p">,</span>
    <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;B02&quot;</span><span class="p">,</span> <span class="s2">&quot;B04&quot;</span><span class="p">,</span> <span class="s2">&quot;B08&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Extract spectral bands and calculate EVI with the &quot;band math&quot; feature</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">sentinel2_cube</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="s2">&quot;B02&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0001</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">sentinel2_cube</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="s2">&quot;B04&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0001</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">sentinel2_cube</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="s2">&quot;B08&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0001</span>
<span class="n">evi</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">nir</span> <span class="o">-</span> <span class="n">red</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nir</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">red</span> <span class="o">-</span> <span class="mf">7.5</span> <span class="o">*</span> <span class="n">blue</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="n">evi_aggregation</span> <span class="o">=</span> <span class="n">evi</span><span class="o">.</span><span class="n">aggregate_spatial</span><span class="p">(</span>
    <span class="n">geometries</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
    <span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Store the parameterized user-defined process at openEO back-end.</span>
<span class="n">process_id</span> <span class="o">=</span> <span class="s2">&quot;evi_timeseries&quot;</span>
<span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="n">user_defined_process_id</span><span class="o">=</span><span class="n">process_id</span><span class="p">,</span>
    <span class="n">process_graph</span><span class="o">=</span><span class="n">evi_aggregation</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">temporal_interval</span><span class="p">,</span> <span class="n">geometry</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this UDP <code class="docutils literal notranslate"><span class="pre">evi_timeseries</span></code> is successfully stored on the back-end,
we can use it through <a class="reference internal" href="api.html#openeo.rest.connection.Connection.datacube_from_process" title="openeo.rest.connection.Connection.datacube_from_process"><code class="xref py py-func docutils literal notranslate"><span class="pre">datacube_from_process()</span></code></a>
to get the EVI timeseries of a desired geometry and time window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">time_window</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-12-31&quot;</span><span class="p">]</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[[[</span><span class="mf">5.1793</span><span class="p">,</span> <span class="mf">51.2498</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.1787</span><span class="p">,</span> <span class="mf">51.2467</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.1852</span><span class="p">,</span> <span class="mf">51.2450</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.1867</span><span class="p">,</span> <span class="mf">51.2453</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.1873</span><span class="p">,</span> <span class="mf">51.2491</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.1793</span><span class="p">,</span> <span class="mf">51.2498</span><span class="p">]]],</span>
  <span class="p">}</span>

<span class="n">evi_timeseries</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">datacube_from_process</span><span class="p">(</span>
    <span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;evi_timeseries&quot;</span><span class="p">,</span>
    <span class="n">temporal_extent</span><span class="o">=</span><span class="n">time_window</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">evi_timeseries</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;evi-aggregation.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">openEO Python Client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Open-EO&repo=openeo-python-client&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">openEO Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_access.html">Finding and loading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="processes.html">Working with processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_jobs.html">Batch Jobs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User-Defined Processes (UDP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#code-reuse-with-user-defined-processes">Code reuse with user-defined processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-parameters">Process Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-and-storing-user-defined-process">Building and storing user-defined process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluate-user-defined-processes">Evaluate user-defined processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#udp-example-evi-timeseries">UDP Example: EVI timeseries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Authentication and Account Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="udf.html">User-Defined Functions (UDF) explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="datacube_construction.html">DataCube construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine_learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook/index.html">openEO CookBook</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API (General)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-processes.html">API: <code class="docutils literal notranslate"><span class="pre">openeo.processes</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api-artifacts.html">API: openeo.extra.artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_mapping.html">openEO Process Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="best_practices.html">Best practices, coding style and general tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="federation-extension.html">Federation extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="batch_jobs.html" title="previous chapter">Batch Jobs</a></li>
      <li>Next: <a href="auth.html" title="next chapter">Authentication and Account Management</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- Alabaster (krTheme++) Hacks -->

<div class="sidebar-meta">
<h3>Meta</h3>
<div>Docs for openEO Python Client</div>
<div>Version: <code>0.49.0a1</code></div>
<div>Last updated: 2026/02/17</div>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017 - 2026, Jeroen Dries.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/udp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>