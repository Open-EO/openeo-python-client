<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Dataset sampling &#8212; openEO Python Client 0.47.0a1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=ad3dbffd" />
    <script src="../_static/documentation_options.js?v=8bea4455"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sharing of user-defined processes" href="udp_sharing.html" />
    <link rel="prev" title="Analysis Ready Data generation" href="ard.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="dataset-sampling">
<h1>Dataset sampling<a class="headerlink" href="#dataset-sampling" title="Link to this heading">¶</a></h1>
<p>A number of use cases do not require a full datacube to be computed,
but rather want to extract a result at specific locations.
Examples include extracting training data for model calibration, or computing the result for
areas where validation data is available.</p>
<p>An important constraint is that most implementations assume that sampling is an operation
on relatively small areas, of for instance up to 512x512 pixels (but often much smaller).
When extracting polygons with larger areas, it is recommended to look into running a separate job per ‘sample’.
Some more important performance notices are mentioned later in the chapter, please read them carefully
to get best results.</p>
<p>Sampling can be done for points or polygons:</p>
<ul class="simple">
<li><p>point extractions basically result in a ‘vector cube’, so can be exported into tabular formats.</p></li>
<li><p>polygon extractions  can be stored to an individual netCDF per polygon so in this case the output is a sparse raster cube.</p></li>
</ul>
<p>Note that sampling many points or polygons may require to send a large amount of geometry, which sometimes makes the size
of the requests too large when it is included inline as GeoJson. Therefore, we recommend to upload your vector data to a
public url, and to load it in openEO using <a class="reference internal" href="../api.html#openeo.rest.connection.Connection.load_url" title="openeo.rest.connection.Connection.load_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">openeo.rest.connection.Connection.load_url()</span></code></a>.</p>
<section id="sampling-at-point-locations">
<h2>Sampling at point locations<a class="headerlink" href="#sampling-at-point-locations" title="Link to this heading">¶</a></h2>
<p>To sample point locations, the <code class="docutils literal notranslate"><span class="pre">openeo.rest.datacube.DataCube.aggregate_spatial</span></code> method can be used. The reducer can be a
commonly supported reducer like <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code> or <code class="docutils literal notranslate"><span class="pre">mean</span></code> and will receive only one value as input in most cases. Note that
in edge cases, a point can intersect with up to 4 pixels. If this is not desirable, it might be worth trying to align
points with pixel centers, which does require more advanced knowledge of the pixel grid of your data cube.</p>
<p>More information on <code class="docutils literal notranslate"><span class="pre">aggregate_spatial</span></code> is available <a class="reference internal" href="#_aggregate-spatial-evi"><span class="xref myst">here</span></a>.</p>
</section>
<section id="sampling-polygons-as-rasters">
<h2>Sampling polygons as rasters<a class="headerlink" href="#sampling-polygons-as-rasters" title="Link to this heading">¶</a></h2>
<p>To indicate to openEO that we only want to compute the datacube for certain polygon features, we use the
<code class="docutils literal notranslate"><span class="pre">openeo.rest.datacube.DataCube.filter_spatial</span></code> method.</p>
<p>Next to that, we will also indicate that we want to write multiple output files. This is more convenient, as we will
want to have one or more raster outputs per sampling feature, for convenient further processing. To do this, we set
the ‘sample_by_feature’ output format property, which is available for the netCDF and GTiff output formats.</p>
<p>Combining all of this, results in the following sample code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s2_bands</span> <span class="o">=</span> <span class="n">auth_connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="s2">&quot;SENTINEL2_L2A&quot;</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;B04&quot;</span><span class="p">],</span>
    <span class="n">temporal_extent</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-06-01&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">s2_bands</span> <span class="o">=</span> <span class="n">s2_bands</span><span class="o">.</span><span class="n">filter_spatial</span><span class="p">(</span>
    <span class="s2">&quot;https://artifactory.vgt.vito.be/testdata-public/parcels/test_10.geojson&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">s2_bands</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Sentinel2&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Sentinel-2 L2A bands&quot;</span><span class="p">,</span>
    <span class="n">out_format</span><span class="o">=</span><span class="s2">&quot;netCDF&quot;</span><span class="p">,</span>
    <span class="n">sample_by_feature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Sampling only works for batch jobs, because it results in multiple output files, which can not be conveniently transferred
in a synchronous call.</p>
</section>
<section id="performance-scalability">
<h2>Performance &amp; scalability<a class="headerlink" href="#performance-scalability" title="Link to this heading">¶</a></h2>
<p>It’s important to note that dataset sampling is not necessarily a cheap operation, since creation of a sparse datacube still
may require accessing a large number of raw EO assets. Backends of course can and should optimize to restrict processing
to a minimum, but the size of the required input datasets is often a determining factor for cost and performance rather
than the size of the output dataset.</p>
</section>
<section id="sampling-at-scale">
<h2>Sampling at scale<a class="headerlink" href="#sampling-at-scale" title="Link to this heading">¶</a></h2>
<p>When doing large scale (e.g. continental) sampling, it is usually not possible or impractical to run it as a single openEO
batch job. The recommendation here is to apply a spatial grouping to your sampling locations, with a single group covering
an area of around 100x100km. The optimal size of a group may be backend dependant. Also remember that when working with
data in the UTM projection, you may want to avoid covering multiple UTM zones in a single group.</p>
<p>See also how to manage <a class="reference internal" href="#_job-manager"><span class="xref myst">multiple jobs</span></a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">openEO Python Client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Open-EO&repo=openeo-python-client&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">openEO Python Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_access.html">Finding and loading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes.html">Working with processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_jobs.html">Batch Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../udp.html">User-Defined Processes (UDP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auth.html">Authentication and Account Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../udf.html">User-Defined Functions (UDF) explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datacube_construction.html">DataCube construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine_learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">openEO CookBook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ard.html">Analysis Ready Data generation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dataset sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="udp_sharing.html">Sharing of user-defined processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectral_indices.html">Spectral Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="job_manager.html">Multi Backend Job Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="localprocessing.html">Client-side (local) processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tricks.html">Miscellaneous tips and tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API (General)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-processes.html">API: <code class="docutils literal notranslate"><span class="pre">openeo.processes</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-artifacts.html">API: openeo.extra.artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process_mapping.html">openEO Process Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_practices.html">Best practices, coding style and general tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../federation-extension.html">Federation extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">openEO CookBook</a><ul>
      <li>Previous: <a href="ard.html" title="previous chapter">Analysis Ready Data generation</a></li>
      <li>Next: <a href="udp_sharing.html" title="next chapter">Sharing of user-defined processes</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- Alabaster (krTheme++) Hacks -->

<div class="sidebar-meta">
<h3>Meta</h3>
<div>Docs for openEO Python Client</div>
<div>Version: <code>0.47.0a1</code></div>
<div>Last updated: 2025/11/01</div>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017 - 2025, Jeroen Dries.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/cookbook/sampling.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>